00001B98 Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 21/12/2019 23:36:25

00000000                             1  ; =============================================================================
00000000                             2  ; TITLE    : EXAMPLE GAME
00000000                             3  ; AUTHOR   :
00000000                             4  ; CREATION : 
00000000                             5  ; =============================================================================
00000000                             6  
00001000                             7              ORG     $1000
00001000                             8              
00001000                             9  ; --- CODE INCLUDES -----------------------------------------------------------
00001000                            10  
00001000                            11              INCLUDE "SYSCONST.X68"          ; SYSTEM CONSTANTS
00001000                            12  ; =============================================================================
00001000                            13  ; SYSTEM CONSTANTS
00001000                            14  ; =============================================================================
00001000                            15  
00001000                            16  ; --- TRAP RELATED CONSTANTS --------------------------------------------------
00001000                            17  
00001000  =00000000                 18  KBDTRAP     EQU     0                       ; KEYBOARD UPDATE TRAP
00001000  =00000001                 19  SCRTRAP     EQU     1                       ; SCREEN REFRESH TRAP
00001000                            20  
00001000                            21  ; --- KEY CODES (EASy68K)
00001000                            22  
00001000  =00000020                 23  KBDCHRSP    EQU     $20                     ; SPACE KEY
00001000  =0000004D                 24  KBDCHRMK    EQU     'M'                     ; M KEY
00001000  =00000010                 25  KBDCHRSH    EQU     $10                     ; SHIFT KEY
00001000  =00000050                 26  KBDCHRPK    EQU     'P'                     ; P KEY
00001000  =00000025                 27  KBDCHRLF    EQU     $25                     ; LEFT KEY
00001000  =00000026                 28  KBDCHRUP    EQU     $26                     ; UP KEY
00001000  =00000027                 29  KBDCHRRT    EQU     $27                     ; RIGHT KEY
00001000  =00000028                 30  KBDCHRDN    EQU     $28                     ; DOWN KEY
00001000                            31  
00001000                            32  ; --- KEYBOARD MAPPING --------------------------------------------------------
00001000                            33  
00001000  =00000025                 34  KBDLEFT     EQU     KBDCHRLF                ; LEFT BUTTON
00001000  =00000026                 35  KBDUP       EQU     KBDCHRUP                ; UP BUTTON
00001000  =00000027                 36  KBDRIGHT    EQU     KBDCHRRT                ; RIGHT BUTTON
00001000  =00000028                 37  KBDDOWN     EQU     KBDCHRDN                ; DOWN BUTTON
00001000  =00000020                 38  KBDFIRE1    EQU     KBDCHRSP                ; FIRE 1 BUTTON
00001000  =0000004D                 39  KBDFIRE2    EQU     KBDCHRMK                ; FIRE 2 BUTTON
00001000  =00000010                 40  KBDFIRE3    EQU     KBDCHRSH                ; FIRE 3 BUTTON
00001000  =00000050                 41  KBDPAUSE    EQU     KBDCHRPK                ; PAUSE BUTTON
00001000                            42  
00001000                            43  ; --- KEYBOARD BITFIELD MASKS -------------------------------------------------
00001000                            44  ; CONVENIENCE CONSTANTS TO ACCESS THE FOLLOWING BIT-FIELD.
00001000                            45  ; THIS BIT-FIELD IS USED BY SYSTEM VARS (KBDVAL) AND (KBDEDGE).
00001000                            46  ; +---+---+---+---+---+---+---+---+
00001000                            47  ; | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
00001000                            48  ; +---+---+---+---+---+---+---+---+
00001000                            49  ;   |   |   |   |   |   |   |   |
00001000                            50  ;   |   |   |   |   |   |   |   +---------- LEFT BUTTON
00001000                            51  ;   |   |   |   |   |   |   +-------------- UP BUTTON
00001000                            52  ;   |   |   |   |   |   +------------------ RIGHT BUTTON
00001000                            53  ;   |   |   |   |   +---------------------- DOWN BUTTON
00001000                            54  ;   |   |   |   +-------------------------- FIRE 1 BUTTON
00001000                            55  ;   |   |   +------------------------------ FIRE 2 BUTTON
00001000                            56  ;   |   +---------------------------------- FIRE 3 BUTTON
00001000                            57  ;   +-------------------------------------- PAUSE BUTTON
00001000                            58  
00001000  =00000001                 59  KBDMSKLF    EQU     %00000001
00001000  =00000002                 60  KBDMSKUP    EQU     %00000010
00001000  =00000004                 61  KBDMSKRT    EQU     %00000100
00001000  =00000008                 62  KBDMSKDN    EQU     %00001000
00001000  =00000010                 63  KBDMSKF1    EQU     %00010000
00001000  =00000020                 64  KBDMSKF2    EQU     %00100000
00001000  =00000040                 65  KBDMSKF3    EQU     %01000000
00001000  =00000080                 66  KBDMSKPS    EQU     %10000000
00001000                            67  
00001000                            68  ; --- KEYBOARD BITFIELD POSITIONS ---------------------------------------------
00001000                            69  
00001000  =00000000                 70  KBDBITLF    EQU     0
00001000  =00000001                 71  KBDBITUP    EQU     1
00001000  =00000002                 72  KBDBITRT    EQU     2
00001000  =00000003                 73  KBDBITDN    EQU     3
00001000  =00000004                 74  KBDBITF1    EQU     4
00001000  =00000005                 75  KBDBITF2    EQU     5
00001000  =00000006                 76  KBDBITF3    EQU     6
00001000  =00000007                 77  KBDBITPS    EQU     7
00001000                            78  
00001000                            79  ; --- SCREEN RELATED CONSTANTS ------------------------------------------------
00001000                            80  
00001000  =000002E4                 81  SCRWIDTH    EQU     740                     ; SCREEN WIDTH (PIXELS)
00001000  =000001E0                 82  SCRHEIGH    EQU     480                     ; SCREEN HEIGHT (PIXELS)
00001000  =00000001                 83  SCRIRQ      EQU     1                       ; SCREEN INTERRUPT NUMBER
00001000  =00000014                 84  SCRTIM      EQU     20                      ; SCREEN TIMER (MS)
00001000                            85  
00001000                            86  ; --- DYNAMIC MEMORY CONSTANTS ------------------------------------------------
00001000                            87  
00001000  =00000040                 88  DMMBSIZE    EQU     64                      ; BLOCK SIZE (BYTES). POWER OF TWO
00001000  =00000032                 89  DMMBNUM     EQU     50                      ; NUMBER OF BLOCKS
00001000  =00000000                 90  DMMSYSID    EQU     0                       ; SYSTEM OWNER ID (MUST BE 0)
00001000                            91  
00001000                            92  
00001000                            93  -------------------- end include --------------------
00001000                            94              INCLUDE "SYSTEM.X68"            ; SYSTEM CODE
00001000                            95  ; =============================================================================
00001000                            96  ; SYSTEM MANAGEMENT (SYSTEM CODE)
00001000                            97  ; =============================================================================
00001000                            98  ;           AUTHORS: Andrea Morey Sánchez and Aisha Gandarova
00001000                            99  ; -----------------------------------------------------------------------------
00001000                           100  SYSINIT
00001000                           101  ; INITIALIZES THE SYSTEM
00001000                           102  ; INPUT    - NONE
00001000                           103  ; OUTPUT   - NONE
00001000                           104  ; MODIFIES - NONE
00001000                           105  ; -----------------------------------------------------------------------------
00001000  205F                     106              MOVE.L  (A7)+,A0                ; GET RETURN ADDRESS
00001002  4EB9 000010A6            107              JSR     KBDINIT                 ; INIT KEYBOARD
00001008  4EB9 0000101C            108              JSR     SCRINIT                 ; INIT SCREEN
0000100E  4EB9 0000111A            109              JSR     DMMINIT                 ; INIT DYNAMIC MEMORY
00001014  027C DFFF                110              ANDI.W  #$DFFF,SR               ; SWITCH TO USER
00001018  2F08                     111              MOVE.L  A0,-(A7)                ; PUT RETURN ADDRESS
0000101A  4E75                     112              RTS
0000101C                           113  
0000101C                           114  ; =============================================================================
0000101C                           115  ; SCREEN MANAGEMENT (SYSTEM CODE)
0000101C                           116  ; =============================================================================
0000101C                           117  
0000101C                           118  ; -----------------------------------------------------------------------------
0000101C                           119  SCRINIT
0000101C                           120  ; INITIALIZES THE SCREEN, SCREEN-RELATED INTERRUPT AND VARS.
0000101C                           121  ; INPUT    - NONE
0000101C                           122  ; OUTPUT   - NONE
0000101C                           123  ; MODIFIES - D0,D1,D2,D3
0000101C                           124  ; -----------------------------------------------------------------------------
0000101C                           125              ; TO DO:
0000101C                           126              ; - DISABLE INTS (SET INT BITS IN SR TO 111)
0000101C  007C 0700                127              ORI.W   #$0700,SR
00001020                           128              ; - DISABLE ALL AUTO-IRQ (SEE TRAP #15 TASK 32)
00001020                           129              ; - INSTALL SCRUPD INTO TRAP SCRTRAP
00001020  21FC 0000108C 0084       130              MOVE.L  #SCRUPD,$80+(SCRTRAP*4)
00001028                           131              ; - SET RESOLUTION TO SCRWIDTH X SCRHEIGHT
00001028  103C 0021                132              MOVE.B  #33,D0
0000102C  223C 02E401E0            133              MOVE.L  #(SCRWIDTH<<16)|SCRHEIGH,D1
00001032  4E4F                     134              TRAP    #15
00001034                           135              ; - SET WINDOWED MODE
00001034  7201                     136              MOVE.L  #1,D1
00001036  4E4F                     137              TRAP    #15
00001038                           138              ; - CLEAR VISIBLE BUFFER
00001038  103C 000B                139              MOVE.B  #11,D0
0000103C  323C FF00                140              MOVE.W  #$FF00,D1
00001040  4E4F                     141              TRAP    #15
00001042                           142              ; - ENABLE DOUBLE BUFFER
00001042  103C 005C                143              MOVE.B  #92,D0
00001046  123C 0011                144              MOVE.B  #17,D1
0000104A  4E4F                     145              TRAP    #15
0000104C                           146              ; - CLEAR HIDDEN BUFFER
0000104C  700B                     147              MOVE.L  #11,D0
0000104E  323C FF00                148              MOVE.W  #$FF00,D1
00001052  4E4F                     149              TRAP    #15
00001054                           150              ; - INSTALL SCRISR FOR IRQ SCRIRQ (IRQ INTERRUPT VECTOR BEGINS
00001054                           151              ;   AT $60. INSTALLATION IS SIMILAR TO TRAP INSTALLATION)
00001054  21FC 0000107E 0064       152              MOVE.L  #SCRISR,$60+(SCRIRQ*4)
0000105C                           153              ; - ENABLE AUTO-IRQ EVERY SCRTIM MS FOR IRQ SCRIRQ (SEE TRAP #15
0000105C                           154              ;   TASK 32)
0000105C  103C 0020                155              MOVE.B  #32,D0
00001060  123C 0006                156              MOVE.B  #6,D1
00001064                           157         
00001064  143C 0081                158              MOVE.B  #$80|SCRIRQ,D2
00001068  7614                     159              MOVE.L  #SCRTIM,D3
0000106A  4E4F                     160              TRAP    #15
0000106C                           161              ; - CLEAR SCRINTCT AND SCRCYCCT
0000106C  4239 00001BC2            162              CLR.B   SCRINTCT
00001072  4239 00001BC3            163              CLR.B   SCRCYCCT
00001078                           164              ; - ENABLE INTS (SET INT BITS IN SR TO 000)
00001078  027C F8FF                165              ANDI.W  #$F8FF,SR
0000107C  4E75                     166              RTS
0000107E                           167  
0000107E                           168  ; -----------------------------------------------------------------------------
0000107E                           169  SCRISR
0000107E                           170  ; SCREEN TIMER ISR. INCREASES THE INTERRUPT COUNTER AND UPDATES DOUBLE BUFFER.
0000107E                           171  ; INPUT    - NONE
0000107E                           172  ; OUTPUT   - NONE
0000107E                           173  ; MODIFIES - NONE
0000107E                           174  ; -----------------------------------------------------------------------------
0000107E  5239 00001BC2            175              ADDQ.B  #1,(SCRINTCT)           ; UPDATE INT FLAG/COUNTER
00001084  5239 00001BC3            176              ADDQ.B  #1,(SCRCYCCT)           ; UPDATE CYCLE COUNTER
0000108A  4E73                     177              RTE
0000108C                           178  
0000108C                           179  ; -----------------------------------------------------------------------------
0000108C                           180  SCRUPD
0000108C                           181  ; TRAP SERVICE ROUTINE IN CHARGE OF VISUALIZING CURRENT FRAME AND CLEARING
0000108C                           182  ; BUFFER FOR THE NEXT ONE.
0000108C                           183  ; INPUT    - NONE
0000108C                           184  ; OUTPUT   - NONE
0000108C                           185  ; MODIFIES - NONE
0000108C                           186  ; -----------------------------------------------------------------------------
0000108C                           187              ; TO DO: UPDATE DOUBLE BUFFER AND CLEAR HIDDEN BUFFER
0000108C  48E7 C000                188              MOVEM.L D0-D1,-(A7)
00001090  103C 005E                189              MOVE.B  #94,D0
00001094  4E4F                     190              TRAP    #15
00001096  103C 000B                191              MOVE.B  #11,D0
0000109A  323C FF00                192              MOVE.W  #$FF00,D1
0000109E  4E4F                     193              TRAP    #15
000010A0  4CDF 0003                194              MOVEM.L (A7)+,D0-D1
000010A4  4E73                     195              RTE
000010A6                           196  
000010A6                           197  ; =============================================================================
000010A6                           198  ; KEYBOARD MANAGEMENT (SYSTEM CODE)
000010A6                           199  ; =============================================================================
000010A6                           200  
000010A6                           201  ; -----------------------------------------------------------------------------
000010A6                           202  KBDINIT
000010A6                           203  ; INITIALIZES THE SYSTEM VARIABLES KBDSYS AND KBDVAL
000010A6                           204  ; INPUT    - NONE
000010A6                           205  ; OUTPUT   - NONE
000010A6                           206  ; MODIFIES - NONE
000010A6                           207  ; -----------------------------------------------------------------------------
000010A6  4239 00001BC0            208              CLR.B   (KBDVAL)                ; INIT VARS
000010AC  4239 00001BC1            209              CLR.B   (KBDEDGE)
000010B2  21FC 000010BC 0080       210              MOVE.L  #KBDREAD,($80+KBDTRAP*4) ; INSTALL
000010BA  4E75                     211              RTS
000010BC                           212  
000010BC                           213  ; -----------------------------------------------------------------------------
000010BC                           214  KBDREAD
000010BC                           215  ; TRAP SERVICE ROUTINE.
000010BC                           216  ; UPDATES THE SYSTEM VARIABLES KBDEDGE AND KBDVAL ACCORDING TO THE BITFIELD
000010BC                           217  ; DESCRIBED IN SYSCONST. KBDVAL HOLDS THE CURRENT VALUES AND KBDEFGE HOLDS
000010BC                           218  ; RISING EDGES FROM PREVIOUS CALL TO THE CURRENT ONE.
000010BC                           219  ; INPUT    - NONE
000010BC                           220  ; OUTPUT   - (KBDVAL) AND (KBDEDGE)
000010BC                           221  ; MODIFIES - NONE
000010BC                           222  ; -----------------------------------------------------------------------------
000010BC                           223              ; TO DO: UPDATE KBDVAL AND KBDEDGE
000010BC  48E7 F800                224              MOVEM.L D0-D4,-(A7)
000010C0  103C 0013                225              MOVE.B  #19,D0
000010C4                           226              
000010C4  223C 50104D20            227              MOVE.L  #KBDPAUSE<<24+KBDFIRE3<<16+KBDFIRE2<<8+KBDFIRE1,D1
000010CA  4E4F                     228              TRAP    #15
000010CC                           229          
000010CC  4202                     230              CLR.B   D2                      ;D2 WILL CONTAIN THE VALUE OF KBDVAL
000010CE  383C 0003                231              MOVE.W  #3,D4
000010D2                           232              
000010D2                           233  .LOOP1      
000010D2                           234       
000010D2  E189                     235              LSL.L   #8,D1                   ;FLAG C = THE VALUE OF THE KBD
000010D4  40C3                     236              MOVE.W  SR,D3                   
000010D6  0243 0001                237              ANDI.W  #$0001,D3               ;D3 = VALUE OF THE FLAG C
000010DA  E30A                     238              LSL.B   #1,D2                   ;MOVE THE BITS TO THE LEFT
000010DC  8403                     239              OR.B    D3,D2                   
000010DE  51CC FFF2                240              DBRA    D4,.LOOP1
000010E2                           241          
000010E2                           242              ;D2 = 0 0 0 0 KBDPAUSE KBDFIRE3 KBDFIRE2 KBDFIRE1
000010E2                           243              
000010E2  223C 28272625            244              MOVE.L  #KBDDOWN<<24+KBDRIGHT<<16+KBDUP<<8+KBDLEFT,D1
000010E8  4E4F                     245              TRAP    #15
000010EA                           246              
000010EA  383C 0003                247              MOVE.W  #3,D4
000010EE                           248  .LOOP2      
000010EE  E189                     249              LSL.L   #8,D1                   ;FLAG C = THE VALUE OF THE KBD
000010F0  40C3                     250              MOVE.W  SR,D3
000010F2  0243 0001                251              ANDI.W  #$0001,D3    
000010F6  E30A                     252              LSL.B   #1,D2
000010F8  8403                     253              OR.B    D3,D2
000010FA                           254              
000010FA  51CC FFF2                255              DBRA    D4,.LOOP2
000010FE                           256              
000010FE                           257              ;D2 = KBDPAUSE KBDFIRE3 KBDFIRE2 KBDFIRE1 KBDDOWN KBDRIGHT KBDUP KBDLEFT
000010FE                           258              
000010FE                           259              ;UPDATE KBDVAL AND KBDEDGE
000010FE  1639 00001BC0            260              MOVE.B  KBDVAL,D3
00001104  4603                     261              NOT.B   D3
00001106  13C2 00001BC0            262              MOVE.B  D2,KBDVAL
0000110C  C602                     263              AND.B   D2,D3
0000110E  13C3 00001BC1            264              MOVE.B  D3,KBDEDGE
00001114  4CDF 001F                265              MOVEM.L (A7)+,D0-D4
00001118  4E73                     266              RTE
0000111A                           267  
0000111A                           268  ; =============================================================================
0000111A                           269  ; DYNAMIC MEMORY MANAGEMENT (SYSTEM CODE)
0000111A                           270  ; DYNAMIC MEMORY IS A SET OF DMMBNUM SLOTS OF DMMBSIZE BYTES EACH ONE.
0000111A                           271  ; DMMBSIZE MUST BE POWER OF TWO. A SLOT HAS:
0000111A                           272  ; - HEADER - 1 WORD. SPECIFIES THE OWNER (0 MEANS OWNED BY SYSTEM)
0000111A                           273  ; - DATA   - DMMBSIZE - 2 BYTES. MAY CONTAIN VARS AND ANY KIND OF DATA RELATED
0000111A                           274  ;            THE THE OWNER. IF OWNER==0, DATA IS MEANINGLESS.
0000111A                           275  ; =============================================================================
0000111A                           276  
0000111A                           277  ; -----------------------------------------------------------------------------
0000111A                           278  DMMINIT
0000111A                           279  ; INITIALIZES THE DYNAMIC MEMORY TO ALL OWNED BY SYSTEM.
0000111A                           280  ; INPUT    - NONE
0000111A                           281  ; OUTPUT   - NONE
0000111A                           282  ; MODIFIES - NONE
0000111A                           283  ; -----------------------------------------------------------------------------
0000111A  48E7 8080                284              MOVEM.L D0/A0,-(A7)
0000111E  41F9 00001C00            285              LEA     DMMDATA,A0
00001124  303C 0031                286              MOVE.W  #DMMBNUM-1,D0
00001128  30BC 0000                287  .LOOP       MOVE.W  #DMMSYSID,(A0)
0000112C  D1FC 00000040            288              ADD.L   #DMMBSIZE,A0
00001132  51C8 FFF4                289              DBRA.W  D0,.LOOP
00001136  4CDF 0101                290              MOVEM.L (A7)+,D0/A0
0000113A  4E75                     291              RTS
0000113C                           292  
0000113C                           293  ; -----------------------------------------------------------------------------
0000113C                           294  DMMFIRST
0000113C                           295  ; SEARCHES THE FIRST MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
0000113C                           296  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
0000113C                           297  ; INPUT    - NONE
0000113C                           298  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
0000113C                           299  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000113C                           300  ; -----------------------------------------------------------------------------
0000113C  41F9 00001C00            301              LEA     DMMDATA,A0
00001142  4A58                     302  DMMFRLOP    TST.W   (A0)+
00001144  6600 0016                303              BNE     DMMFRFND
00001148  D1FC 0000003E            304              ADD.L   #DMMBSIZE-2,A0
0000114E  B1FC 0000287F            305  DMMFRCOM    CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
00001154  6DEC                     306              BLT     DMMFRLOP
00001156  207C 00000000            307              MOVE.L  #0,A0
0000115C  4E75                     308  DMMFRFND    RTS
0000115E                           309  
0000115E                           310  ; -----------------------------------------------------------------------------
0000115E                           311  DMMNEXT
0000115E                           312  ; SEARCHES THE NEXT MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
0000115E                           313  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
0000115E                           314  ; INPUT    - A0   : POINTER WITHIN THE CURRENT SLOT
0000115E                           315  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
0000115E                           316  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000115E                           317  ; -----------------------------------------------------------------------------
0000115E  2F00                     318              MOVE.L  D0,-(A7)
00001160  2008                     319              MOVE.L  A0,D0
00001162  C0BC FFFFFFC0            320              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
00001168  0680 00000040            321              ADD.L   #DMMBSIZE,D0
0000116E  2040                     322              MOVE.L  D0,A0
00001170  201F                     323              MOVE.L  (A7)+,D0
00001172  60DA                     324              BRA     DMMFRCOM
00001174                           325  
00001174                           326  ; -----------------------------------------------------------------------------
00001174                           327  DMMFRSTO
00001174                           328  ; SEARCHES THE FIRST MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
00001174                           329  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001174                           330  ; INPUT    - D0.W : ID TO SEARCH
00001174                           331  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001174                           332  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001174                           333  ; -----------------------------------------------------------------------------
00001174  41F9 00001C00            334              LEA     DMMDATA,A0
0000117A  B058                     335  DMMFLOOP    CMP.W   (A0)+,D0
0000117C  6700 0016                336              BEQ     DMMFFND
00001180  D1FC 0000003E            337              ADD.L   #DMMBSIZE-2,A0
00001186  B1FC 0000287F            338  DMMFCOM     CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
0000118C  6DEC                     339              BLT     DMMFLOOP
0000118E  207C 00000000            340              MOVE.L  #0,A0
00001194  4E75                     341  DMMFFND     RTS
00001196                           342  
00001196                           343  ; -----------------------------------------------------------------------------
00001196                           344  DMMNEXTO
00001196                           345  ; SEARCHES THE NEXT MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
00001196                           346  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001196                           347  ; INPUT    - D0.W : ID TO SEARCH
00001196                           348  ;            A0   : POINTER WITHIN THE CURRENT SLOT
00001196                           349  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001196                           350  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001196                           351  ; -----------------------------------------------------------------------------
00001196  2F00                     352              MOVE.L  D0,-(A7)
00001198  2008                     353              MOVE.L  A0,D0
0000119A  C0BC FFFFFFC0            354              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
000011A0  0680 00000040            355              ADD.L   #DMMBSIZE,D0
000011A6  2040                     356              MOVE.L  D0,A0
000011A8  201F                     357              MOVE.L  (A7)+,D0
000011AA  60DA                     358              BRA     DMMFCOM
000011AC                           359  
000011AC                           360  ; -----------------------------------------------------------------------------
000011AC                           361  DMMALLOC
000011AC                           362  ; SEARCHES THE FIRST FREE (SYS OWNED) SLOT, ASSIGNS TO THE SPECIFIED OWNER
000011AC                           363  ; AND RETURNS A POINTER TO THE CORRESPONDING DATA (SLOT ADDRESS + 2)
000011AC                           364  ; INPUT    - D0.W : ID TO ASSIGN
000011AC                           365  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FREE SPACE
000011AC                           366  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000011AC                           367  ; -----------------------------------------------------------------------------
000011AC  3F00                     368              MOVE.W  D0,-(A7)
000011AE  4240                     369              CLR.W   D0
000011B0  4EB8 1174                370              JSR     DMMFRSTO
000011B4  301F                     371              MOVE.W  (A7)+,D0
000011B6  B1FC 00000000            372              CMP.L   #0,A0
000011BC  6700 0006                373              BEQ     .END
000011C0  3140 FFFE                374              MOVE.W  D0,-2(A0)
000011C4  4E75                     375  .END        RTS
000011C6                           376  
000011C6                           377  ; -----------------------------------------------------------------------------
000011C6                           378  DMMFREE
000011C6                           379  ; FREES THE SLOT TO WHICH THE PROVIDED POINTER BELONGS BY SETTING ITS OWNED TO
000011C6                           380  ; SYSTEM (0)
000011C6                           381  ; INPUT    - A0   : POINTER BELONGING TO THE SLOT TO FREE
000011C6                           382  ; OUTPUT   - NONE
000011C6                           383  ; MODIFIES - NONE
000011C6                           384  ; -----------------------------------------------------------------------------
000011C6  48E7 8080                385              MOVEM.L D0/A0,-(A7)
000011CA  2008                     386              MOVE.L  A0,D0
000011CC  C0BC FFFFFFC0            387              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
000011D2  2040                     388              MOVE.L  D0,A0
000011D4  4250                     389              CLR.W   (A0)
000011D6  4CDF 0101                390              MOVEM.L (A7)+,D0/A0
000011DA  4E75                     391              RTS
000011DC                           392  
000011DC                           393  
000011DC                           394  
000011DC                           395  
000011DC                           396  
000011DC                           397  
000011DC                           398  
000011DC                           399  
000011DC                           400  
000011DC                           401  
000011DC                           402  
000011DC                           403  
000011DC                           404  
000011DC                           405  
000011DC                           406  
000011DC                           407  
000011DC                           408  
000011DC                           409  
000011DC                           410  
000011DC                           411  
000011DC                           412  
000011DC                           413  -------------------- end include --------------------
000011DC                           414              INCLUDE "CONSTANTS.X68"         ;CONSTANTES DEL JUEGO
000011DC                           415  ; =============================================================================
000011DC                           416  ; CONSTANTS
000011DC                           417  ; =============================================================================
000011DC                           418  
000011DC                           419  ; --- INTRO STATE RELATED CONSTANTS -------------------------------------------
000011DC                           420  
000011DC  =0000000E                421  INTTITX     EQU     14                      ; TITLE X COORDINATE
000011DC  =00000007                422  INTTITY     EQU     7                       ; TITLE Y COORDINATE
000011DC  =00DCAA7C                423  INTTITC     EQU     $00DCAA7C               ; TITLE COLOR
000011DC  =00000020                424  INTPRSX     EQU     32                      ; PRESS FIRE X COORDINATE
000011DC  =00000052                425  INTPRSY     EQU     82                      ; PRESS FIRE Y COORDINATE
000011DC  =00FFFFFF                426  INTPRSC     EQU     $00FFFFFF               ; PRESS FIRE COLOR
000011DC  =00000012                427  TXBSIZE     EQU     18                      ;BIG SIZE LETTERS
000011DC  =00000010                428  TXMSIZE     EQU     16                      ;MEDIUM SIZE LETTERS
000011DC  =0000000A                429  TXSSIZE     EQU     10                      ;SMALL SIZE LETTERS
000011DC                           430  
000011DC                           431  ; STATES GAME ---------------------------------------------------------------
000011DC  =FFFFFFFF                432  STANONE     EQU     -1                      ; PLACEHOLDER TO FORCE CHANGE
000011DC  =00000000                433  STAINTR     EQU     0                       ; INTRO/PRESS FIRE STATE
000011DC  =00000001                434  STASPACE    EQU     1                       ; ESPERA EL ESPACIO PARA DISPARAR LA BOLA 
000011DC  =00000002                435  STAPLAY    EQU     2                       ; NORMAL GAME STATE
000011DC                           436  ;STAPLAY2    EQU     3
000011DC                           437  ;STAPLAY3    EQU     4
000011DC  =00000003                438  STAGOVR     EQU     3                       ; GAME OVER STATE
000011DC                           439  ;----------------------------------------------------------------------------
000011DC                           440  
000011DC                           441  ; --- GAME OVER STATE RELATED CONSTANTS ---------------------------------------
000011DC                           442  
000011DC  =00000012                443  GOVERX      EQU     18                      ; GAME OVER X COORDINATE
000011DC  =00000007                444  GOVERY      EQU     7                       ; GAME OVER Y COORDINATE
000011DC  =0000FFFF                445  GOVERC      EQU     $0000FFFF               ; GAME OVER COLOR
000011DC                           446  
000011DC                           447  ; SCREENCTRL---------------------------------------------------------------------
000011DC  =00000201                448  SCRCTRL     EQU     513   
000011DC  =00000005                449  SCRLWIDTH   EQU     5
000011DC  =00000040                450  LIVEWIDTH   EQU     64
000011DC  =00000010                451  LIVEHEIGHT  EQU     16
000011DC  =000000FF                452  LIVECOLOR   EQU     $000000FF               ;ROJO
000011DC  =00000215                453  LIVEPOSX    EQU     SCRCTRL+20
000011DC  =0000001E                454  LIVEPOSY    EQU     30
000011DC                           455  
000011DC                           456  ;----------------------------------------------------------------------------
000011DC                           457  
000011DC                           458  
000011DC                           459  ; PLAYER --------------------------------------------------------------------
000011DC                           460  
000011DC  =00000040                461  PINWIDTH1    EQU     64                      ; PLAYER INITIAL WIDTH (PIXELS)
000011DC  =00000038                462  PINWIDTH2    EQU     56
000011DC  =00000030                463  PINWIDTH3    EQU     48
000011DC  =0000000C                464  PHEIGHT     EQU     12                      ; PLAYER HEIGHT (PIXELS)
000011DC  =00ECD59D                465  PCOLOR      EQU     $00ECD59D               ; PLAYER NORMAL COLOR
000011DC  =00000003                466  PINLIVE     EQU     3                       ;PLAYER INTIAL LIVES 
000011DC  =00000008                467  PMOVE       EQU     8                       ;SPEED OF THE PLAYER (ALWAYS THE SAME)
000011DC  =000001D0                468  PPOSY       EQU     SCRHEIGH-PHEIGHT-4      ;POSICION DE LA PLATAFORMA Y
000011DC  =000000E0                469  PINPOSX1     EQU     SCRCTRL/2-PINWIDTH1/2
000011DC  =000000E4                470  PINPOSX2     EQU     SCRCTRL/2-PINWIDTH2/2
000011DC  =000000E8                471  PINPOSX3     EQU     SCRCTRL/2-PINWIDTH3/2
000011DC  =00000032                472  PSCORETX     EQU    50                       ; SCORE X COORDINATE
000011DC  =00000004                473  PSCORETY     EQU    4                       ; SCORE Y COORDINATE
000011DC  =00FFFFFF                474  PSCORECOL   EQU     $00FFFFFF
000011DC                           475  ; ---------------------------------------------------------------------------
000011DC                           476  
000011DC                           477  ; BALL ----------------------------------------------------------------------
000011DC  =0000000A                478  BDIAMET     EQU     10                       ;ANCHURA DE LA BOLA
000011DC  =000000FB                479  BINPOSX     EQU     SCRCTRL/2-BDIAMET/2     ;POSICION DE LA PELOTA X INICIAL
000011DC  =000001CE                480  BINPOSY     EQU     PPOSY-2                 ;POSICION DE LA PELOTA Y INICIAL
000011DC  =FFFFFFFD                481  BINSPEED    EQU     -3                       ;INITIAL SPEED (HASTA LLEGAR A 500 PUNTOS)
000011DC                           482  
000011DC  =00FFFFFF                483  BINCOLOR    EQU     $00FFFFFF
000011DC                           484  
000011DC                           485  ; ---------------------------------------------------------------------------
000011DC                           486  
000011DC                           487  
000011DC                           488  ;BLOCKS-------------------------------------------------------------------------
000011DC  =00000040                489  BLWIDTH     EQU     64
000011DC  =00000010                490  BLHEIGHT     EQU     16
000011DC= 00F7E78E 004E8CF3 ...    491  COLORS      DC.L    BLUE,ORANGE,PURPLE,YELLOW,GREEN,BLUE,ORANGE,PURPLE,YELLOW,GREEN,BLUE,ORANGE
0000120C  =0000000C                492  BLROW       EQU     12
0000120C  =00000008                493  BLCOL       EQU     8
0000120C                           494  
0000120C                           495  
0000120C                           496  ;-------------------------------------------------------------------------------
0000120C                           497  
0000120C                           498  ;COLORS-------------------------------------------------------------
0000120C  =004E8CF3                499  ORANGE      EQU     $004E8CF3
0000120C  =00F7E78E                500  BLUE        EQU     $00F7E78E
0000120C  =00FFACAC                501  PURPLE      EQU     $00FFACAC
0000120C  =0038EEF8                502  YELLOW      EQU     $0038EEF8
0000120C  =0095FF8C                503  GREEN       EQU     $0095FF8C
0000120C                           504  ;-------------------------------------------------------------------
0000120C                           505  
0000120C                           506  
0000120C                           507  
0000120C                           508  
0000120C                           509  
0000120C                           510  
0000120C                           511  
0000120C                           512  
0000120C                           513  
0000120C                           514  
0000120C                           515  
0000120C                           516  
0000120C                           517  
0000120C                           518  
0000120C                           519  
0000120C                           520  
0000120C                           521  
0000120C                           522  
0000120C                           523  
0000120C                           524  
0000120C                           525  
0000120C                           526  
0000120C                           527  
0000120C                           528  
0000120C                           529  
0000120C                           530  
0000120C                           531  -------------------- end include --------------------
0000120C                           532              INCLUDE "UTIL.X68"
0000120C                           533  ; =============================================================================
0000120C                           534  ; UTILITY MACROS
0000120C                           535  ; =============================================================================
0000120C                           536  
0000120C                           537  UTLSPEN     MACRO
0000120C                           538  ; WRAPPER FOR SET PEN TRAP 15 TASK.
0000120C                           539  ; INPUT    - \1 COLOR IN FORMAT $00BBGGRR
0000120C                           540  ; OUTPUT   - NONE
0000120C                           541  ; MODIFIES - D0,D1
0000120C                           542  ; -----------------------------------------------------------------------------
0000120C                           543              MOVE.B  #80,D0
0000120C                           544              MOVE.L  \1,D1
0000120C                           545              TRAP    #15
0000120C                           546              ENDM
0000120C                           547  
0000120C                           548  ; -----------------------------------------------------------------------------
0000120C                           549  UTLSIZC     MACRO
0000120C                           550  ; WRAPPER FOR SET SIZE AND COLOR TRAP 15 TASK.
0000120C                           551  ; INPUT    - \1 COLOR IN FORMAT $00BBGGRR \2 SIZE (8, 9, 10, 12, 14, 16, 18))
0000120C                           552  ; OUTPUT   - NONE
0000120C                           553  ; MODIFIES - D0,D1
0000120C                           554  ; -----------------------------------------------------------------------------
0000120C                           555              MOVE.L  \1,D1
0000120C                           556              MOVE.L  #\2<<16|1,D2
0000120C                           557              MOVE.B  #21,D0
0000120C                           558              TRAP    #15
0000120C                           559              ENDM
0000120C                           560  ; -----------------------------------------------------------------------------
0000120C                           561  UTLSFIL     MACRO
0000120C                           562  ; WRAPPER FOR SET FIL TRAP 15 TASK.
0000120C                           563  ; INPUT    - \1 COLOR IN FORMAT $00BBGGRR
0000120C                           564  ; OUTPUT   - NONE
0000120C                           565  ; MODIFIES - D0,D1
0000120C                           566  ; -----------------------------------------------------------------------------
0000120C                           567              MOVE.B  #81,D0
0000120C                           568              MOVE.L  \1,D1
0000120C                           569              TRAP    #15
0000120C                           570              ENDM
0000120C                           571              
0000120C                           572  ; -----------------------------------------------------------------------------
0000120C                           573  UTLLOCT     MACRO
0000120C                           574  ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
0000120C                           575  ; INPUT    - \1 X, \2 Y
0000120C                           576  ; OUTPUT   - NONE
0000120C                           577  ; MODIFIES - D0,D1
0000120C                           578  ; -----------------------------------------------------------------------------
0000120C                           579              MOVE.W  #\1<<8|\2, D1
0000120C                           580              MOVE.B  #11,D0
0000120C                           581              TRAP    #15
0000120C                           582              ENDM
0000120C                           583     
0000120C                           584  ; -----------------------------------------------------------------------------
0000120C                           585  UTLSNDS     MACRO
0000120C                           586  ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
0000120C                           587  ; INPUT    - \1 ADDRESS TO STRING WITH NAME OF THE FILE, \2 NUM SOUNDS, 
0000120C                           588  ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
0000120C                           589  ; MODIFIES - D0,A1
0000120C                           590  ; -----------------------------------------------------------------------------
0000120C                           591              LEA     \1, A1             ;PLAY EXPLOSION SOUND
0000120C                           592              MOVE.W  \2,D1
0000120C                           593              MOVE.B  #71,D0
0000120C                           594              TRAP    #15
0000120C                           595              MOVE.B  #72,D0
0000120C                           596              TRAP    #15
0000120C                           597              
0000120C                           598              ENDM
0000120C                           599              
0000120C                           600  ; -----------------------------------------------------------------------------
0000120C                           601  UTLSNDST     MACRO
0000120C                           602  ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
0000120C                           603  ; INPUT    - NONE 
0000120C                           604  ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
0000120C                           605  ; MODIFIES - D0,A1
0000120C                           606  ; -----------------------------------------------------------------------------
0000120C                           607              MOVE.L  #3,D2
0000120C                           608              MOVE.B  #76,D0
0000120C                           609              TRAP    #15
0000120C                           610              
0000120C                           611              ENDM
0000120C                           612              
0000120C                           613  ; =============================================================================
0000120C                           614  ; UTILITY SUBROUTINES
0000120C                           615  ; =============================================================================
0000120C                           616  ; -----------------------------------------------------------------------------
0000120C                           617  UTLCHCOLW
0000120C                           618  ; CHECKS COLLISION WITH WALL
0000120C                           619  ; INPUT    - D0.W BPOSX1
0000120C                           620  ;            D1.W BPOSY1
0000120C                           621  ;            D2.W BPOSX2
0000120C                           622  ;            D3.W BPOSY2
0000120C                           623  ; OUTPUT   - 
0000120C                           624  ; MODIFIES - 
0000120C                           625  ; -----------------------------------------------------------------------------
0000120C  48E7 F080                626              MOVEM.L D0-D3/A0,-(A7)
00001210  41F9 000012EE            627              LEA.L   .COLLISIONS,A0
00001216  B258                     628              CMP.W   (A0)+,D1      ;UP
00001218  6E00 001C                629              BGT     .LEFT
0000121C                           630  
0000121C  4479 00002892            631              NEG.W   BSPEEDY
00001222  4279 0000289A            632              CLR.W   BPOSY1
00001228  33FC 000A 0000289C       633              MOVE.W  #BDIAMET,BPOSY2
00001230  4EF9 000012E8            634              JMP     .END 
00001236                           635  .LEFT        
00001236  B058                     636              CMP.W   (A0)+,D0
00001238  6E00 001C                637              BGT     .RIGHT
0000123C  4479 00002890            638              NEG.W   BSPEEDX
00001242  4279 00002896            639              CLR.W   BPOSX1
00001248  33FC 000A 00002898       640              MOVE.W  #BDIAMET,BPOSX2
00001250  4EF9 000012E8            641              JMP     .END
00001256                           642  .RIGHT      
00001256                           643              
00001256  B458                     644              CMP.W   (A0)+,D2
00001258  6D00 001E                645              BLT     .DOWN
0000125C  4479 00002890            646              NEG.W   BSPEEDX
00001262  33FC 0201 00002898       647              MOVE.W  #SCRCTRL,BPOSX2
0000126A  33FC 01F7 00002896       648              MOVE.W  #SCRCTRL-BDIAMET,BPOSX1
00001272  4EF9 000012E8            649              JMP     .END
00001278                           650  .DOWN       
00001278  B658                     651              CMP.W   (A0)+,D3         
0000127A  6E00 0008                652              BGT     .MINLIVE                  
0000127E  4EF9 000012E8            653              JMP     .END  
00001284                           654  .MINLIVE       
00001284                           655m             UTLSNDS .SOUNDL,#1
00001284                           656m ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
00001284                           657m ; INPUT    - .SOUNDL ADDRESS TO STRING WITH NAME OF THE FILE, #1 NUM SOUNDS, 
00001284                           658m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001284                           659m ; MODIFIES - D0,A1
00001284                           660m ; -----------------------------------------------------------------------------
0000129A  33FC 01E0 0000289C       661              MOVE.W  #SCRHEIGH,BPOSY2
000012A2  33FC 01D6 0000289A       662              MOVE.W  #SCRHEIGH-BDIAMET,BPOSY1 
000012AA  5379 00002888            663              SUB.W   #1,PLIVES                
000012B0  6600 002E                664              BNE     .RESET               ;SALTA SI NO SE HAN AGOTADO LAS VIDAS              
000012B4                           665m             UTLSNDST
000012B4                           666m ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
000012B4                           667m ; INPUT    - NONE 
000012B4                           668m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
000012B4                           669m ; MODIFIES - D0,A1
000012B4                           670m ; -----------------------------------------------------------------------------
000012BC                           671m             UTLSNDS .SOUNDG,#1
000012BC                           672m ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
000012BC                           673m ; INPUT    - .SOUNDG ADDRESS TO STRING WITH NAME OF THE FILE, #1 NUM SOUNDS, 
000012BC                           674m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
000012BC                           675m ; MODIFIES - D0,A1
000012BC                           676m ; -----------------------------------------------------------------------------
000012D2  33FC 0003 00002882       677              MOVE.W  #STAGOVR,(STANEXT)
000012DA  4EF9 000012E8            678              JMP     .END
000012E0                           679  .RESET     
000012E0                           680              
000012E0  33FC 0001 00002882       681              MOVE.W  #STASPACE,(STANEXT) 
000012E8                           682             
000012E8                           683  .END        
000012E8  4CDF 010F                684              MOVEM.L (A7)+,D0-D3/A0
000012EC  4E75                     685              RTS
000012EE= 0000 0000 0201 01E0      686  .COLLISIONS DC.W    0,0,SCRCTRL,SCRHEIGH
000012F6= 67616D65 206F7665 ...    687  .SOUNDG      DC.L    'game over.wav',0
0000130A= 6C6F7365 206C6966 ...    688  .SOUNDL     DC.L    'lose life.wav',0
0000131E                           689  ; -----------------------------------------------------------------------------
0000131E                           690  UTLCHCOLP
0000131E                           691  ; CHECKS COLLISION WITH PLATAFORM
0000131E                           692  ; INPUT    - D0.W BPOSX1
0000131E                           693  ;            D1.W BPOSY1
0000131E                           694  ;            D2.W PPOSX2
0000131E                           695  ;            D3.W PPOSY2
0000131E                           696  ; OUTPUT   
0000131E                           697  ;           
0000131E                           698  ; MODIFIES - D4,D5
0000131E                           699  ; -----------------------------------------------------------------------------
0000131E  48E7 0C00                700              MOVEM.L D4-D5,-(A7)
00001322  383C 01D0                701              MOVE.W  #PPOSY,D4
00001326  B644                     702              CMP.W   D4,D3
00001328  6D00 0086                703              BLT     .END                    ;SI ESTÁ MÁS A ARRIBA DE LA PLATAFORMA NO HAY COLISIÓN
0000132C  3839 00002884            704              MOVE.W  PPOSX,D4
00001332  B444                     705              CMP.W   D4,D2
00001334  6D00 007A                706              BLT     .END                    ;SI ESTÁ MÁS A LA IZQUIERDA DE LA PLATAFORMA NO HAY COLISIÓN
00001338  D879 00002886            707              ADD.W   PWIDTH,D4
0000133E  B044                     708              CMP.W    D4,D0
00001340  6E00 006E                709              BGT     .END                    ;SI ESTÁ MÁS A LA DERECHA NO HAY COLISIÓN
00001344                           710              ;AQUÍ HAY COLISIÓN, TENEMOS QUE DETECTAR CUAL
00001344  383C 01D0                711              MOVE.W  #PPOSY,D4
00001348  B244                     712              CMP.W   D4,D1
0000134A  6E00 005E                713              BGT     .LADOS
0000134E  4479 00002892            714              NEG.W   BSPEEDY                 ;COLISIÓN CON LA PARTE DE ARRIBA
00001354  33C4 0000289C            715              MOVE.W  D4,BPOSY2
0000135A  0444 000A                716              SUB.W   #BDIAMET,D4
0000135E  33C4 0000289A            717              MOVE.W  D4,BPOSY1       
00001364                           718  .PLRXMIDDLE 
00001364  3839 00002886            719              MOVE.W  PWIDTH,D4
0000136A  E24C                     720              LSR.W   #1,D4
0000136C  3A39 00002884            721              MOVE.W  PPOSX,D5 
00001372  DA44                     722              ADD.W   D4,D5                   ;D5 = CENTRO PLATAFORMA
00001374  BA42                     723              CMP.W   D2,D5                   ;CENTRO - POS PEL
00001376  6B00 001A                724              BMI     .PLRXRIGHT
0000137A  3839 00002890            725              MOVE.W  BSPEEDX,D4
00001380  6B00 002E                726              BMI     .END
00001384                           727                                           
00001384  4444                     728              NEG.W   D4
00001386  33C4 00002890            729              MOVE.W  D4,BSPEEDX
0000138C  4EF9 000013B0            730              JMP     .END
00001392                           731              
00001392                           732  .PLRXRIGHT             
00001392  3839 00002890            733              MOVE.W  BSPEEDX,D4
00001398  6A00 0016                734              BPL     .END              ;SI ES POSITIVO SOLO NEGAMOS Y
0000139C  4444                     735              NEG.W   D4
0000139E  33C4 00002890            736              MOVE.W  D4,BSPEEDX
000013A4  4EF9 000013B0            737              JMP     .END
000013AA                           738  
000013AA  4479 00002890            739  .LADOS      NEG.W   BSPEEDX                 ;COLISIÓN CON LOS LADOS
000013B0  4CDF 0030                740  .END        MOVEM.L (A7)+,D4-D5 
000013B4  4E75                     741              RTS
000013B6                           742  
000013B6                           743  
000013B6                           744  ; -----------------------------------------------------------------------------
000013B6                           745  UTLCOLBL   
000013B6                           746  ; CHECKS COLLISION WITH BLOCKS
000013B6                           747  ; INPUT    - POSITION BALL \1 X \2 Y TO CHECK COLLISION WITH BLOCK
000013B6                           748  ; OUTPUT   
000013B6                           749  ;           
000013B6                           750  ; MODIFIES - NONE
000013B6                           751  ; -----------------------------------------------------------------------------
000013B6  E849                     752              LSR.W   #4,D1           ;POSY/BLHEIGHT. D1 -> FILA
000013B8  343C 000B                753              MOVE.W  #BLROW-1,D2
000013BC  B441                     754              CMP.W   D1,D2           ;SI ESTÁ POR DEBAJO DE LA ÚLTIMA FILA SALTA DIRECTO A END
000013BE  6D00 00C2                755              BLT     .ENDNOCOLISION                    
000013C2  41F9 000028A0            756              LEA.L   BLMATRIX,A0
000013C8  D1C1                     757              ADDA.L  D1,A0           ;CARGAMOS EN A0 LA DIRECCIÓN DEL BYTE DE LA FILA
000013CA                           758                                          
000013CA  EC48                     759              LSR.W   #6,D0           ;D0 -> COLUMNA 
000013CC  363C 0007                760              MOVE.W  #BLCOL-1,D3                           
000013D0  9640                     761              SUB.W   D0,D3           ;D3 -> COLUMNA (DESDE DRCHA) DONDE ESTÁ LA BOLA
000013D2  3E03                     762              MOVE.W  D3,D7
000013D4  6A00 0004                763              BPL     .TEST  
000013D8  4283                     764              CLR.L   D3              ;POR SI SALE NEGATIVO LA REAJUSTAMOS
000013DA                           765  .TEST
000013DA  0710                     766              BTST.B  D3,(A0)         ;MIRAMOS EL BIT DONDE ESTA 
000013DC  6700 00A4                767              BEQ     .ENDNOCOLISION  ; SALTA SI EN ESA POSICION YA HABIA UN 0
000013E0                           768  
000013E0                           769  .IZQ        
000013E0  EC4D                     770              LSR.W   #6,D5           ;D5 -> COLUMNA
000013E2  343C 0007                771              MOVE.W  #BLCOL-1,D2
000013E6  9445                     772              SUB.W   D5,D2           ;D2 -> COLUMNA (DESDE DERECHA) DONDE ESTA EL PUNTO CONTRARIO (SI 1 ENTONCES 2)
000013E8  B443                     773              CMP     D3,D2                  
000013EA  6F00 000E                774              BLE     .CHOQUEDOBLE
000013EE  4479 00002890            775              NEG.W   BSPEEDX
000013F4                           776              
000013F4  4EF9 00001452            777              JMP     .ENDCOLISION    ;  (|)______|  COLISION DELADO IZQUIERDO COLISIONANDO POR LA IZQ DEL NLOQUE 
000013FA                           778              
000013FA                           779  
000013FA                           780  
000013FA                           781  
000013FA                           782  .CHOQUEDOBLE                        ;SI ESTA EN MEDIO DEL BLOQUE  |___()___| COLISION EN MEDIO
000013FA                           783                                      ;COMPARAMOS SI LE HA DADO A DOS A LA VEZ |______(|)______|
000013FA  B443                     784              CMP     D3,D2
000013FC  6700 0036                785              BEQ     .ENMEDIO
00001400                           786              
00001400  5A40                     787              ADDI.W  #BDIAMET/2,D0
00001402  EC48                     788              LSR.W   #6,D0
00001404  3A3C 0007                789              MOVE.W  #BLCOL-1,D5     ;D1 -> COLUMNA DONDE SE ENCUENTRA EL PUNTO MEDIO DE LA BOLA                         
00001408                           790              
00001408  9A40                     791              SUB.W   D0,D5
0000140A  6A00 0004                792              BPL     .TEST2  
0000140E  4285                     793              CLR.L   D5              ;POR SI SALE NEGATIVO LA REAJUSTAMOS
00001410                           794  .TEST2
00001410                           795              
00001410  0B10                     796              BTST.B  D5,(A0)         ;MIRAMOS EL BIT DONDE ESTA 
00001412  6700 0020                797              BEQ     .ENMEDIO
00001416  BE45                     798              CMP     D5,D7
00001418  6700 000E                799              BEQ     .CHOQUEDOBLEIZQ
0000141C  4479 00002892            800              NEG.W   BSPEEDY
00001422  4EF9 00001452            801              JMP     .ENDCOLISION
00001428                           802  .CHOQUEDOBLEIZQ
00001428  4479 00002890            803              NEG.W   BSPEEDX
0000142E  4EF9 00001452            804              JMP     .ENDCOLISION
00001434                           805  
00001434                           806              
00001434                           807  .ENMEDIO            
00001434                           808              ;COMPARAMOS SI LA PARTE CONTRARIA ESTA DENTO DEL BLOQUE O FUERA
00001434  B443                     809              CMP     D3,D2
00001436  6D00 000E                810              BLT     .DERECHA
0000143A  4479 00002892            811              NEG.W   BSPEEDY
00001440  4EF9 00001452            812              JMP     .ENDCOLISION
00001446                           813  .DERECHA
00001446  4479 00002890            814              NEG.W   BSPEEDX
0000144C  4EF9 00001452            815              JMP     .ENDCOLISION
00001452                           816              
00001452                           817  
00001452                           818  .ENDCOLISION
00001452                           819              
00001452  383C 0001                820              MOVE.W  #1,D4
00001456  0790                     821              BCLR    D3,(A0)
00001458  5379 0000289E            822              SUB.W   #1,BLCOUNTER       
0000145E  0679 0064 0000288A       823              ADD.W   #100,PSCORE
00001466                           824m             UTLSNDS  .SOUND,#1
00001466                           825m ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
00001466                           826m ; INPUT    - .SOUND ADDRESS TO STRING WITH NAME OF THE FILE, #1 NUM SOUNDS, 
00001466                           827m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001466                           828m ; MODIFIES - D0,A1
00001466                           829m ; -----------------------------------------------------------------------------
0000147C  5379 0000289E            830              SUB.W   #1,BLCOUNTER
00001482                           831  .ENDNOCOLISION
00001482  4E75                     832              RTS
00001484= 626C6F63 6B732E77 ...    833  .SOUND      DC.L    'blocks.wav',0
00001494                           834  ; -----------------------------------------------------------------------------
00001494                           835  UTLCHCOL
00001494                           836  ; CHECKS COLLISION
00001494                           837  ; INPUT    - D0.W X0 COORDINATE ball
00001494                           838  ;            D1.W Y0 COORDINATE ball
00001494                           839  ;            D2.W X1 COORDINATE plataforma
00001494                           840  ;            D3.W Y1 COORDINATE plataforma
00001494                           841  ;            D4.W WIDTH 0      ball
00001494                           842  ;            D5.W WIDTH 1      plataforma 
00001494                           843  ;            D6.W HEIGHT 0     ball
00001494                           844  ;            D7.W HEIGHT 1     plataforma
00001494                           845  ; OUTPUT   - D0.B=FF - COLLISION, =0 - NO COLLISION
00001494                           846  ; MODIFIES - NONE
00001494                           847  ; -----------------------------------------------------------------------------
00001494  48A7 0F00                848              MOVEM.W D4-D7,-(A7)
00001498  D840                     849              ADD.W   D0,D4
0000149A  B842                     850              CMP.W   D2,D4
0000149C  6F00 0022                851              BLE     .NOCOL
000014A0  DA42                     852              ADD.W   D2,D5
000014A2  BA40                     853              CMP.W   D0,D5
000014A4  6F00 001A                854              BLE     .NOCOL
000014A8  DC41                     855              ADD.W   D1,D6
000014AA  BC43                     856              CMP.W   D3,D6
000014AC  6F00 0012                857              BLE     .NOCOL
000014B0  DE43                     858              ADD.W   D3,D7
000014B2  BE41                     859              CMP.W   D1,D7
000014B4  6F00 000A                860              BLE     .NOCOL
000014B8  103C 00FF                861              MOVE.B  #$FF,D0
000014BC  6000 0004                862              BRA     .END
000014C0  4200                     863  .NOCOL      CLR.B   D0
000014C2  4C9F 00F0                864  .END        MOVEM.W (A7)+,D4-D7
000014C6  4E75                     865              RTS
000014C8                           866  
000014C8                           867  
000014C8                           868  
000014C8                           869  UTLSCTRLP
000014C8  48E7 FC40                870              MOVEM.L D0-D5/A1,-(A7)    
000014CC                           871              ;DIBUJA LA BARRA DE SEPARACIÓN
000014CC  223C 00FFFFFF            872              MOVE.L  #$00FFFFFF,D1  ;COLOR
000014D2  103C 0050                873              MOVE.B  #80,D0
000014D6  4E4F                     874              TRAP    #15
000014D8                           875              
000014D8  C2BC 00FFFFFF            876              AND.L   #$00FFFFFF,D1  ;COLOR
000014DE  103C 0051                877              MOVE.B  #81,D0
000014E2  4E4F                     878              TRAP    #15
000014E4                           879              
000014E4  103C 0057                880              MOVE.B  #87,D0
000014E8  323C 0201                881              MOVE.W  #SCRCTRL,D1
000014EC  363C 0206                882              MOVE.W  #SCRCTRL+SCRLWIDTH,D3
000014F0  4282                     883              CLR.L   D2
000014F2  383C 01E0                884              MOVE.W  #SCRHEIGH,D4
000014F6  4E4F                     885              TRAP    #15
000014F8                           886              
000014F8                           887              ;SCORE
000014F8                           888m             UTLLOCT PSCORETX,PSCORETY            
000014F8                           889m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
000014F8                           890m ; INPUT    - PSCORETX X, PSCORETY Y
000014F8                           891m ; OUTPUT   - NONE
000014F8                           892m ; MODIFIES - D0,D1
000014F8                           893m ; -----------------------------------------------------------------------------
00001502                           894m             UTLSIZC #PSCORECOL,TXMSIZE           ;PENCOLOR Y TAMAÑO
00001502                           895m ; WRAPPER FOR SET SIZE AND COLOR TRAP 15 TASK.
00001502                           896m ; INPUT    - #PSCORECOL COLOR IN FORMAT $00BBGGRR TXMSIZE SIZE (8, 9, 10, 12, 14, 16, 18))
00001502                           897m ; OUTPUT   - NONE
00001502                           898m ; MODIFIES - D0,D1
00001502                           899m ; -----------------------------------------------------------------------------
00001514                           900m             UTLSFIL #$00000000
00001514                           901m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001514                           902m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
00001514                           903m ; OUTPUT   - NONE
00001514                           904m ; MODIFIES - D0,D1
00001514                           905m ; -----------------------------------------------------------------------------
0000151C  43F9 00001534            906              LEA     .TXTSCORE,A1              ;PONE EL TEXTO
00001522  3239 0000288A            907              MOVE.W  PSCORE,D1
00001528  103C 0011                908              MOVE.B  #17,D0
0000152C  4E4F                     909              TRAP    #15
0000152E                           910              
0000152E  4CDF 023F                911              MOVEM.L (A7)+,D0-D5/A1
00001532  4E75                     912              RTS   
00001534= 53 43 4F 52 45 3A ...    913  .TXTSCORE   DC.B    'SCORE: ',0
0000153C                           914              DS.W    0
0000153C                           915  
0000153C                           916  
0000153C                           917  
0000153C                           918  
0000153C                           919  
0000153C                           920  
0000153C                           921  
0000153C                           922  
0000153C                           923  
0000153C                           924  -------------------- end include --------------------
0000153C                           925              INCLUDE "PLAYER.X68"            ;EL JUGADOR
0000153C                           926  ; -----------------------------------------------------------------------------
0000153C                           927  ;           PLAYER
0000153C                           928  ; -----------------------------------------------------------------------------
0000153C                           929  PLRINIT
0000153C                           930  ; INITIALIZES THE PLAYER
0000153C                           931  ; INPUT    - NONE
0000153C                           932  ; OUTPUT   - NONE
0000153C                           933  ; MODIFIES - NONE
0000153C                           934  ; -----------------------------------------------------------------------------
0000153C                           935              
0000153C  33FC 00E0 00002884       936              MOVE.W  #PINPOSX1,PPOSX
00001544  33FC 0040 00002886       937              MOVE.W  #PINWIDTH1,PWIDTH
0000154C                           938              
0000154C                           939            
0000154C  4E75                     940              RTS
0000154E                           941              
0000154E                           942  ; -----------------------------------------------------------------------------
0000154E                           943  PLRREV
0000154E                           944  ; PLAYER REVIVES, INITIALIZE POSITION
0000154E                           945  ; INPUT    - NONE
0000154E                           946  ; OUTPUT   - NONE
0000154E                           947  ; MODIFIES - NONE
0000154E                           948  ; -----------------------------------------------------------------------------
0000154E                           949              ;DEBERIAMOS CALCULAR LA POSICION NUEVA A PARTIR DE LA WIDTH QUE NOS PASEN
0000154E                           950              
0000154E  33FC 00E0 00002884       951              MOVE.W  #PINPOSX1,PPOSX
00001556  33FC 0040 00002886       952              MOVE.W  #PINWIDTH1,PWIDTH
0000155E                           953            
0000155E  4E75                     954              RTS
00001560                           955  
00001560                           956  ; -----------------------------------------------------------------------------
00001560                           957  
00001560                           958  PLRUPD      
00001560  48E7 6000                959              MOVEM.L D1-D2,-(A7)
00001564  1239 00001BC0            960              MOVE.B  KBDVAL,D1  
0000156A  E219                     961              ROR.B   #1,D1                   ;IZQUIERDA
0000156C  6400 0016                962              BCC     .RIGHTKEY               ;CUANDO C = 0
00001570                           963              ;CUANDO PPOSX ES 0 NO TINENE QUE MOVERSE MAS A LA IZQ
00001570  3439 00002884            964              MOVE.W  PPOSX,D2
00001576  B47C 0000                965              CMP.W    #0,D2
0000157A  6F00 0008                966              BLE     .RIGHTKEY
0000157E  5179 00002884            967              SUB.W   #PMOVE,(PPOSX)
00001584                           968  .RIGHTKEY
00001584  E209                     969              LSR.B   #1,D1                   
00001586  E219                     970              ROR.B   #1,D1                   
00001588  6400 001C                971              BCC     .END
0000158C                           972              ;CUANDO PPOSX ES IGUAL A SCRWIDTH+PWIDTH NO TIENE QUE MOVERSE A LA DERECHA
0000158C  3439 00002884            973              MOVE.W  PPOSX,D2
00001592  D479 00002886            974              ADD.W   PWIDTH,D2 
00001598                           975  
00001598  B47C 01FC                976              CMP.W    #SCRCTRL-SCRLWIDTH,D2
0000159C  6C00 0008                977              BGE     .END
000015A0  5079 00002884            978              ADD.W   #PMOVE,PPOSX
000015A6                           979  .END
000015A6  4CDF 0006                980              MOVEM.L (A7)+,D1-D2
000015AA  4E75                     981              RTS
000015AC                           982  
000015AC                           983  
000015AC                           984  PPLOT
000015AC  48E7 FC40                985              MOVEM.L  D0-D5/A1,-(A7)
000015B0                           986              ;PLOT THE PLATAFORM
000015B0                           987m             UTLSPEN #PCOLOR 
000015B0                           988m ; WRAPPER FOR SET PEN TRAP 15 TASK.
000015B0                           989m ; INPUT    - #PCOLOR COLOR IN FORMAT $00BBGGRR
000015B0                           990m ; OUTPUT   - NONE
000015B0                           991m ; MODIFIES - D0,D1
000015B0                           992m ; -----------------------------------------------------------------------------
000015BC                           993m             UTLSFIL #PCOLOR
000015BC                           994m ; WRAPPER FOR SET FIL TRAP 15 TASK.
000015BC                           995m ; INPUT    - #PCOLOR COLOR IN FORMAT $00BBGGRR
000015BC                           996m ; OUTPUT   - NONE
000015BC                           997m ; MODIFIES - D0,D1
000015BC                           998m ; -----------------------------------------------------------------------------
000015C8  3239 00002884            999              MOVE.W  PPOSX,D1
000015CE  343C 01D0               1000              MOVE.W  #PPOSY,D2                    
000015D2  3639 00002884           1001              MOVE.W  PPOSX,D3
000015D8  3839 00002886           1002              MOVE.W  PWIDTH,D4 
000015DE  D644                    1003              ADD.W   D4,D3
000015E0  383C 01DC               1004              MOVE.W  #PPOSY+PHEIGHT,D4
000015E4  303C 0057               1005              MOVE.W  #87,D0
000015E8  4E4F                    1006              TRAP    #15
000015EA                          1007              
000015EA                          1008              ;PLOT LIFE
000015EA  3A39 00002888           1009              MOVE.W  PLIVES,D5
000015F0  6700 0076               1010              BEQ     .END
000015F4                          1011m             UTLSPEN #$00FFFFFF  
000015F4                          1012m ; WRAPPER FOR SET PEN TRAP 15 TASK.
000015F4                          1013m ; INPUT    - #$00FFFFFF COLOR IN FORMAT $00BBGGRR
000015F4                          1014m ; OUTPUT   - NONE
000015F4                          1015m ; MODIFIES - D0,D1
000015F4                          1016m ; -----------------------------------------------------------------------------
00001600                          1017m             UTLSFIL #LIVECOLOR
00001600                          1018m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001600                          1019m ; INPUT    - #LIVECOLOR COLOR IN FORMAT $00BBGGRR
00001600                          1020m ; OUTPUT   - NONE
00001600                          1021m ; MODIFIES - D0,D1
00001600                          1022m ; -----------------------------------------------------------------------------
0000160C  5345                    1023              SUB.W   #1,D5             
0000160E  103C 0057               1024              MOVE.B  #87,D0
00001612  323C 0215               1025              MOVE.W  #LIVEPOSX,D1
00001616  3601                    1026              MOVE.W  D1,D3
00001618  0643 0040               1027              ADD.W   #LIVEWIDTH,D3
0000161C  343C 001E               1028              MOVE.W  #LIVEPOSY,D2
00001620  3802                    1029              MOVE.W  D2,D4
00001622  0644 0010               1030              ADD.W   #LIVEHEIGHT,D4
00001626                          1031  .LOOP           
00001626  4E4F                    1032              TRAP    #15
00001628  3203                    1033              MOVE.W  D3,D1
0000162A  0643 0040               1034              ADD.W   #LIVEWIDTH,D3
0000162E  51CD FFF6               1035              DBRA    D5,.LOOP
00001632                          1036              
00001632                          1037              ;PLOT SCORE
00001632                          1038m             UTLLOCT PSCORETX,PSCORETY            
00001632                          1039m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001632                          1040m ; INPUT    - PSCORETX X, PSCORETY Y
00001632                          1041m ; OUTPUT   - NONE
00001632                          1042m ; MODIFIES - D0,D1
00001632                          1043m ; -----------------------------------------------------------------------------
0000163C                          1044m             UTLSIZC #PSCORECOL,TXMSIZE           ;PENCOLOR Y TAMAÑO
0000163C                          1045m ; WRAPPER FOR SET SIZE AND COLOR TRAP 15 TASK.
0000163C                          1046m ; INPUT    - #PSCORECOL COLOR IN FORMAT $00BBGGRR TXMSIZE SIZE (8, 9, 10, 12, 14, 16, 18))
0000163C                          1047m ; OUTPUT   - NONE
0000163C                          1048m ; MODIFIES - D0,D1
0000163C                          1049m ; -----------------------------------------------------------------------------
0000164E                          1050m             UTLSFIL #$00000000
0000164E                          1051m ; WRAPPER FOR SET FIL TRAP 15 TASK.
0000164E                          1052m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
0000164E                          1053m ; OUTPUT   - NONE
0000164E                          1054m ; MODIFIES - D0,D1
0000164E                          1055m ; -----------------------------------------------------------------------------
00001656  43F9 0000166E           1056              LEA     .TXTSCORE,A1              ;PONE EL TEXTO
0000165C  3239 0000288A           1057              MOVE.W  PSCORE,D1
00001662  103C 0011               1058              MOVE.B  #17,D0
00001666  4E4F                    1059              TRAP    #15
00001668                          1060              
00001668                          1061  .END            
00001668  4CDF 023F               1062              MOVEM.L (A7)+,D0-D5/A1
0000166C  4E75                    1063              RTS
0000166E                          1064              
0000166E= 53 43 4F 52 45 3A ...   1065  .TXTSCORE   DC.B    'SCORE: ',0
00001676                          1066              DS.W    0
00001676                          1067  
00001676                          1068  
00001676                          1069  
00001676                          1070  
00001676                          1071  
00001676                          1072  
00001676                          1073  
00001676                          1074  
00001676                          1075  
00001676                          1076  
00001676                          1077  
00001676                          1078  
00001676                          1079  
00001676                          1080  
00001676                          1081  
00001676                          1082  
00001676                          1083  
00001676                          1084  -------------------- end include --------------------
00001676                          1085              INCLUDE "STATES.X68"            ;
00001676                          1086  ; =============================================================================
00001676                          1087  ; GAME STATE MANAGEMENT
00001676                          1088  ; =============================================================================
00001676                          1089  
00001676                          1090  ; -----------------------------------------------------------------------------
00001676                          1091  STAINIT
00001676                          1092  ; INITALIZES THE STATE MANAGER
00001676                          1093  ; INPUT    - NONE
00001676                          1094  ; OUTPUT   - NONE
00001676                          1095  ; MODIFIES - NONE
00001676                          1096  ; -----------------------------------------------------------------------------
00001676  33FC FFFF 00002880      1097              MOVE.W  #STANONE,(STACUR)       ;STACUR = -1 
0000167E                          1098             ; TENEMOS QUE SABER SI -1 = CAMBIO O SE QUEDA EN EL MISMO
0000167E  33FC 0000 00002882      1099              MOVE.W  #STAINTR,(STANEXT)      ;STAINTR = LA PANTALLA INTRO = 0
00001686  4E75                    1100              RTS
00001688                          1101  
00001688                          1102  ; -----------------------------------------------------------------------------
00001688                          1103  STAUPD
00001688                          1104  ; PERFORMS STATE UPDATE AND INIT IF NECESSARY
00001688                          1105  ; INPUT    - NONE
00001688                          1106  ; OUTPUT   - NONE
00001688                          1107  ; MODIFIES - NONE
00001688                          1108  ; -----------------------------------------------------------------------------
00001688  48E7 8080               1109              MOVEM.L D0/A0,-(A7)
0000168C  4280                    1110              CLR.L   D0
0000168E  3039 00002882           1111              MOVE.W  (STANEXT),D0
00001694  B079 00002880           1112              CMP.W   (STACUR),D0
0000169A  6700 0012               1113              BEQ     .DOUPD
0000169E  33C0 00002880           1114              MOVE.W  D0,(STACUR)             ;AHORA ES LA PANTALLA DE INTRO
000016A4  E588                    1115              LSL.L   #2,D0
000016A6  2040                    1116              MOVE.L  D0,A0
000016A8  2068 16C6               1117              MOVE.L  .INITBL(A0),A0
000016AC  4E90                    1118              JSR     (A0)
000016AE  4280                    1119  .DOUPD      CLR.L   D0                      ; IN ANY CASE, DO UPDATE
000016B0  3039 00002880           1120              MOVE.W  (STACUR),D0
000016B6  E588                    1121              LSL.L   #2,D0
000016B8  2040                    1122              MOVE.L  D0,A0
000016BA  2068 16D2               1123              MOVE.L  .UPDTBL(A0),A0
000016BE  4E90                    1124              JSR     (A0)
000016C0  4CDF 0101               1125              MOVEM.L (A7)+,D0/A0
000016C4  4E75                    1126              RTS
000016C6= 0000175A 00001710 ...   1127  .INITBL     DC.L    STAINTRI,STAPLAYI,STAEMPTY ;EL 0 ES VACIAR LA MEMORIA DEL JUEGO
000016D2                          1128                                               ;EL 1 ES LO QUE INICIA EL JUEGO = PINIT
000016D2                          1129                                               ;EL 2 ES NO HACER NADA 
000016D2= 0000178A 0000171C ...   1130  .UPDTBL     DC.L    STAINTRU,STASPACEU,STAPLAYU,STAGOVRU
000016E2                          1131                                              ;EL 0 ES SI SE PULSA ESPACIO CAMBIAR EL STANEXT A PLAY
000016E2                          1132                                              ;EL 2 HACE QUE SE UPDATE 
000016E2                          1133  
000016E2                          1134  ; -----------------------------------------------------------------------------
000016E2                          1135  STAPLOT
000016E2                          1136  ; PERFORMS STATE PLOT
000016E2                          1137  ; INPUT    - NONE
000016E2                          1138  ; OUTPUT   - NONE
000016E2                          1139  ; MODIFIES - NONE
000016E2                          1140  ; -----------------------------------------------------------------------------
000016E2  48E7 8080               1141              MOVEM.L D0/A0,-(A7)
000016E6  4280                    1142              CLR.L   D0
000016E8  3039 00002880           1143              MOVE.W  (STACUR),D0
000016EE  E588                    1144              LSL.L   #2,D0
000016F0  2040                    1145              MOVE.L  D0,A0
000016F2  2068 16FE               1146              MOVE.L  .PLTTBL(A0),A0          ;ELIGE QUE HACER
000016F6  4E90                    1147              JSR     (A0)
000016F8  4CDF 0101               1148              MOVEM.L (A7)+,D0/A0
000016FC  4E75                    1149              RTS
000016FE= 000017BC 00001744 ...   1150  .PLTTBL     DC.L    STAINTRP,STAPLAYP,STAPLAYP,STAGOVRP
0000170E                          1151                             ;SPACE      NIVEL1   NIVEL2    NIVEL3   
0000170E                          1152  
0000170E                          1153  ; -----------------------------------------------------------------------------
0000170E                          1154  STAEMPTY
0000170E                          1155  ; EMPTY SUBROUTINE FOR CASES WITH NOTHING TO DO
0000170E                          1156  ; INPUT    - NONE
0000170E                          1157  ; OUTPUT   - NONE
0000170E                          1158  ; MODIFIES - NONE
0000170E                          1159  ; NOTE     - JUST A PLACEHOLDER. NOTHING TO DO.
0000170E                          1160  ; -----------------------------------------------------------------------------
0000170E  4E75                    1161              RTS
00001710                          1162  
00001710                          1163  ; -----------------------------------------------------------------------------
00001710                          1164  STAPLAYI    ;DEL NIVEL1, COMIENZO
00001710                          1165  
00001710                          1166  ; PLAY STATE INITIALIZATION.
00001710                          1167  ; INPUT    - NONE
00001710                          1168  ; OUTPUT   - NONE
00001710                          1169  ; MODIFIES - NONE
00001710                          1170  ; NOTE     - JUST A WRAPPER FOR PLRINIT
00001710                          1171  ; -----------------------------------------------------------------------------
00001710  4EB8 153C               1172              JSR     PLRINIT
00001714  4EB9 00001894           1173              JSR     BINIT
0000171A  4E75                    1174              RTS
0000171C                          1175  ; -----------------------------------------------------------------------------
0000171C                          1176  STASPACEU
0000171C                          1177  ; WAITS FOR SPACE TO BE PRESSED, AND BEGIN THE GAME
0000171C                          1178  ; INPUT    - NONE
0000171C                          1179  ; OUTPUT   - NONE
0000171C                          1180  ; MODIFIES - NONE
0000171C                          1181  ; -----------------------------------------------------------------------------
0000171C                          1182             
0000171C  0839 0004 00001BC1      1183              BTST.B  #KBDBITF1,(KBDEDGE)
00001724  6700 000A               1184              BEQ     .END
00001728  33FC 0002 00002882      1185              MOVE.W  #STAPLAY,(STANEXT)
00001730                          1186  .END        
00001730  4E75                    1187              RTS
00001732                          1188                               
00001732                          1189  
00001732                          1190  ; -----------------------------------------------------------------------------
00001732                          1191  STAPLAYU
00001732                          1192  ; PLAY STATE UPDATE
00001732                          1193  ; INPUT    - NONE
00001732                          1194  ; OUTPUT   - NONE
00001732                          1195  ; MODIFIES - NONE
00001732                          1196  ; -----------------------------------------------------------------------------
00001732                          1197              
00001732  4EB8 1560               1198              JSR     PLRUPD
00001736  4EB9 00001928           1199              JSR     BUPD    
0000173C  4EB9 00001AE8           1200              JSR     BLUPD                
00001742  4E75                    1201              RTS
00001744                          1202  ; -----------------------------------------------------------------------------
00001744                          1203  STAPLAYP
00001744                          1204  ; PLAY STATE PLOT
00001744                          1205  ; INPUT    - NONE
00001744                          1206  ; OUTPUT   - NONE
00001744                          1207  ; MODIFIES - NONE
00001744                          1208  ; -----------------------------------------------------------------------------
00001744  4EB9 00001B2E           1209              JSR     BLPLOT
0000174A  4EB8 15AC               1210              JSR     PPLOT
0000174E  4EB9 000019F4           1211              JSR     BPLOT
00001754  4EB8 14C8               1212              JSR     UTLSCTRLP
00001758  4E75                    1213              RTS
0000175A                          1214  
0000175A                          1215  ; -----------------------------------------------------------------------------
0000175A                          1216  STAINTRI                  ;VACIA LA MEMORIA DEL JUEGO
0000175A                          1217  ; PARA QUE EL SCORE LA VIDA SE VUELVAN A REINICIAR
0000175A                          1218  
0000175A                          1219  ; INTRO STATE INIT
0000175A                          1220  ; INPUT    - NONE
0000175A                          1221  ; OUTPUT   - NONE
0000175A                          1222  ; MODIFIES - NONE
0000175A                          1223  ; NOTE     - JUST A WRAPPER FOR DMMINIT TO RELEASE ALL MEMORY
0000175A                          1224  ; -----------------------------------------------------------------------------
0000175A                          1225m             UTLSNDS .SOUND,#1
0000175A                          1226m ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
0000175A                          1227m ; INPUT    - .SOUND ADDRESS TO STRING WITH NAME OF THE FILE, #1 NUM SOUNDS, 
0000175A                          1228m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
0000175A                          1229m ; MODIFIES - D0,A1
0000175A                          1230m ; -----------------------------------------------------------------------------
00001770  4EB8 111A               1231              JSR     DMMINIT
00001774  4E75                    1232              RTS
00001776= 73746172 74206C61 ...   1233  .SOUND      DC.L    'start largo.wav',0
0000178A                          1234  ; -----------------------------------------------------------------------------
0000178A                          1235  STAINTRU
0000178A                          1236  ; INTRO STATE UPDATE
0000178A                          1237  ; INPUT    - NONE
0000178A                          1238  ; OUTPUT   - NONE
0000178A                          1239  ; MODIFIES - NONE
0000178A                          1240  ; -----------------------------------------------------------------------------
0000178A                          1241              
0000178A  0839 0004 00001BC1      1242              BTST.B  #KBDBITF1,(KBDEDGE)
00001792  6700 0026               1243              BEQ     .END
00001796                          1244m             UTLSNDST
00001796                          1245m ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
00001796                          1246m ; INPUT    - NONE 
00001796                          1247m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001796                          1248m ; MODIFIES - D0,A1
00001796                          1249m ; -----------------------------------------------------------------------------
0000179E  33FC 0001 00002882      1250              MOVE.W  #STASPACE,(STANEXT)
000017A6  4EB9 00001A34           1251              JSR     BLINIT
000017AC  33FC 0003 00002888      1252              MOVE.W  #PINLIVE,PLIVES
000017B4  4279 0000288A           1253              CLR.W   PSCORE            
000017BA  4E75                    1254  .END        RTS
000017BC                          1255  
000017BC                          1256  ; -----------------------------------------------------------------------------
000017BC                          1257  STAINTRP
000017BC                          1258  ; INTRO STATE PLOT
000017BC                          1259  ; INPUT    - NONE
000017BC                          1260  ; OUTPUT   - NONE
000017BC                          1261  ; MODIFIES - NONE
000017BC                          1262  ; -----------------------------------------------------------------------------
000017BC  48E7 E040               1263              MOVEM.L A1/D0-D2,-(A7)
000017C0                          1264              ;TITULO
000017C0                          1265m             UTLLOCT INTTITX,INTTITY      
000017C0                          1266m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
000017C0                          1267m ; INPUT    - INTTITX X, INTTITY Y
000017C0                          1268m ; OUTPUT   - NONE
000017C0                          1269m ; MODIFIES - D0,D1
000017C0                          1270m ; -----------------------------------------------------------------------------
000017CA                          1271m             UTLSIZC #INTTITC,TXBSIZE
000017CA                          1272m ; WRAPPER FOR SET SIZE AND COLOR TRAP 15 TASK.
000017CA                          1273m ; INPUT    - #INTTITC COLOR IN FORMAT $00BBGGRR TXBSIZE SIZE (8, 9, 10, 12, 14, 16, 18))
000017CA                          1274m ; OUTPUT   - NONE
000017CA                          1275m ; MODIFIES - D0,D1
000017CA                          1276m ; -----------------------------------------------------------------------------
000017DC  43F9 00001816           1277              LEA     .TITSTR,A1            
000017E2  103C 000E               1278              MOVE.B  #14,D0
000017E6  4E4F                    1279              TRAP    #15
000017E8                          1280              
000017E8                          1281              ;START
000017E8                          1282m             UTLLOCT INTPRSX,INTPRSY
000017E8                          1283m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
000017E8                          1284m ; INPUT    - INTPRSX X, INTPRSY Y
000017E8                          1285m ; OUTPUT   - NONE
000017E8                          1286m ; MODIFIES - D0,D1
000017E8                          1287m ; -----------------------------------------------------------------------------
000017F2                          1288m             UTLSIZC #INTPRSC,TXSSIZE
000017F2                          1289m ; WRAPPER FOR SET SIZE AND COLOR TRAP 15 TASK.
000017F2                          1290m ; INPUT    - #INTPRSC COLOR IN FORMAT $00BBGGRR TXSSIZE SIZE (8, 9, 10, 12, 14, 16, 18))
000017F2                          1291m ; OUTPUT   - NONE
000017F2                          1292m ; MODIFIES - D0,D1
000017F2                          1293m ; -----------------------------------------------------------------------------
00001804  43F9 00001826           1294              LEA     .PRSSTR,A1
0000180A  103C 000E               1295              MOVE.B  #14,D0
0000180E  4E4F                    1296              TRAP    #15
00001810                          1297              
00001810  4CDF 0207               1298              MOVEM.L (A7)+,A1/D0-D2
00001814  4E75                    1299              RTS
00001816                          1300  
00001816= 42 72 65 61 6B 69 ...   1301  .TITSTR     DC.B    'Breaking Blocks',0
00001826= 50 55 53 48 20 46 ...   1302  .PRSSTR     DC.B    'PUSH FIRE TO START',0
0000183A                          1303              DS.W    0
0000183A                          1304  ; -----------------------------------------------------------------------------
0000183A                          1305  STAGOVRU
0000183A                          1306  ; GAME OVER STATE UPDATE
0000183A                          1307  ; INPUT    - NONE
0000183A                          1308  ; OUTPUT   - NONE
0000183A                          1309  ; MODIFIES - NONE
0000183A                          1310  ; -----------------------------------------------------------------------------
0000183A  0839 0004 00001BC1      1311              BTST.B  #KBDBITF1,(KBDEDGE)
00001842  6700 0012               1312              BEQ     .END
00001846                          1313m             UTLSNDST
00001846                          1314m ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
00001846                          1315m ; INPUT    - NONE 
00001846                          1316m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001846                          1317m ; MODIFIES - D0,A1
00001846                          1318m ; -----------------------------------------------------------------------------
0000184E  33FC 0000 00002882      1319              MOVE.W  #STAINTR,(STANEXT)
00001856  4E75                    1320  .END        RTS
00001858                          1321  
00001858                          1322  ; -----------------------------------------------------------------------------
00001858                          1323  STAGOVRP
00001858                          1324  ; GAME OVER STATE PLOT
00001858                          1325  ; INPUT    - NONE
00001858                          1326  ; OUTPUT   - NONE
00001858                          1327  ; MODIFIES - NONE
00001858                          1328  ; -----------------------------------------------------------------------------
00001858                          1329  
00001858  48E7 E040               1330              MOVEM.L A1/D0-D2,-(A7)
0000185C                          1331              
0000185C                          1332              ;GAME OVER TEXT
0000185C                          1333m             UTLLOCT GOVERX,GOVERY            
0000185C                          1334m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
0000185C                          1335m ; INPUT    - GOVERX X, GOVERY Y
0000185C                          1336m ; OUTPUT   - NONE
0000185C                          1337m ; MODIFIES - D0,D1
0000185C                          1338m ; -----------------------------------------------------------------------------
00001866                          1339m             UTLSIZC #GOVERC,TXBSIZE
00001866                          1340m ; WRAPPER FOR SET SIZE AND COLOR TRAP 15 TASK.
00001866                          1341m ; INPUT    - #GOVERC COLOR IN FORMAT $00BBGGRR TXBSIZE SIZE (8, 9, 10, 12, 14, 16, 18))
00001866                          1342m ; OUTPUT   - NONE
00001866                          1343m ; MODIFIES - D0,D1
00001866                          1344m ; -----------------------------------------------------------------------------
00001878  43F9 0000188A           1345              LEA     .GOVSTR,A1              ;PONE EL TEXTO
0000187E  103C 000E               1346              MOVE.B  #14,D0
00001882  4E4F                    1347              TRAP    #15
00001884                          1348  
00001884  4CDF 0207               1349              MOVEM.L (A7)+,A1/D0-D2
00001888  4E75                    1350              RTS
0000188A= 47 41 4D 45 20 4F ...   1351  .GOVSTR     DC.B    'GAME OVER',0
00001894                          1352              DS.W    0
00001894                          1353  
00001894                          1354  
00001894                          1355  
00001894                          1356  
00001894                          1357  
00001894                          1358  
00001894                          1359  
00001894                          1360  
00001894                          1361  
00001894                          1362  -------------------- end include --------------------
00001894                          1363              INCLUDE "BALL.X68"              ;LA PELOTA
00001894                          1364  ; =============================================================================
00001894                          1365  ; BALL
00001894                          1366  ; =============================================================================
00001894                          1367  ;----------------------------------
00001894                          1368  BINIT
00001894                          1369  ;INITIALIZE THE BALL
00001894                          1370  ;----------------------------------
00001894  33FC 00FB 00002896      1371              MOVE.W  #BINPOSX,BPOSX1
0000189C  33FC 01CE 0000289C      1372              MOVE.W  #BINPOSY,BPOSY2
000018A4  33FC 0105 00002898      1373              MOVE.W  #BINPOSX+BDIAMET,BPOSX2
000018AC  33FC 01C4 0000289A      1374              MOVE.W  #BINPOSY-BDIAMET,BPOSY1
000018B4  33FC FFFD 00002890      1375              MOVE.W  #BINSPEED,BSPEEDX
000018BC  33FC FFFD 00002892      1376              MOVE.W  #BINSPEED,BSPEEDY
000018C4  4E75                    1377              RTS
000018C6                          1378  ;----------------------------------         
000018C6                          1379  BNXTLEV
000018C6                          1380  ;INITIALIZE THE BALL TO THE NEXT LEVEL
000018C6                          1381  ;----------------------------------
000018C6                          1382  ;BALL NEXT LEVEL       (NEXT LEVEL)
000018C6  48E7 8000               1383              MOVEM.L D0,-(A7)
000018CA  33FC 00FB 00002896      1384              MOVE.W  #BINPOSX,BPOSX1
000018D2  33FC 01CE 0000289A      1385              MOVE.W  #BINPOSY,BPOSY1
000018DA  33FC 0105 00002898      1386              MOVE.W  #BINPOSX+BDIAMET,BPOSX2
000018E2  33FC 0105 0000289C      1387              MOVE.W  #BINPOSX+BDIAMET,BPOSY2
000018EA  3039 00002892           1388              MOVE.W  BSPEEDY,D0
000018F0  6B00 000E               1389              BMI     .NEGY
000018F4  5279 00002892           1390              ADD.W   #1,BSPEEDY
000018FA  4EB9 00001906           1391              JSR     .X
00001900                          1392  .NEGY        
00001900  5379 00002892           1393              SUB.W   #1,BSPEEDY
00001906                          1394  .X          
00001906  3039 00002890           1395              MOVE.W  BSPEEDX,D0
0000190C  6B00 000E               1396              BMI     .NEGX 
00001910  5279 00002890           1397              ADD.W   #1,BSPEEDX
00001916  4EB9 00001922           1398              JSR     .END
0000191C                          1399  .NEGX       
0000191C  5379 00002890           1400              SUB.W   #1,BSPEEDX 
00001922                          1401  .END        
00001922  4CDF 0001               1402              MOVEM.L (A7)+,D0
00001926  4E75                    1403              RTS
00001928                          1404        
00001928                          1405  ;-----------------------------------------------------------------------------
00001928                          1406  BUPD
00001928                          1407  ;UPDATES THE BALL
00001928                          1408  ;-----------------------------------
00001928                          1409  ; UPDATES THE BALL MOTION
00001928                          1410  ; INPUT    - NONE 
00001928                          1411  ; OUTPUT   - NONE 
00001928                          1412  ; MODIFIES - NONE
00001928                          1413  ; -----------------------------------------------------------------------------
00001928                          1414  
00001928  48E7 FF80               1415              MOVEM.L D0-D7/A0,-(A7)
0000192C                          1416              ;COMPRUEBA COLISIONES CON LAS 4 PAREDES
0000192C                          1417              ;Y SI PASA LA DE ABAJO LE ELIMINA UNA VIDA, O ENVIA LA PANTALLA GAME OVER
0000192C  3039 00002896           1418              MOVE.W  BPOSX1,D0
00001932  3239 0000289A           1419              MOVE.W  BPOSY1,D1
00001938  3439 00002898           1420              MOVE.W  BPOSX2,D2
0000193E  3639 0000289C           1421              MOVE.W  BPOSY2,D3
00001944  4EB8 120C               1422              JSR     UTLCHCOLW               ;COMPRUEBA COLISIÓN CON PAREDES               
00001948  4EB8 131E               1423              JSR     UTLCHCOLP               ;COMPRUEBA COLISIÓN CON PLATAFORMA
0000194C  4284                    1424              CLR.L  D4
0000194E  3A39 00002898           1425              MOVE.W  BPOSX2,D5
00001954  3C39 0000289C           1426              MOVE.W  BPOSY2,D6
0000195A  4EB8 13B6               1427              JSR     UTLCOLBL
0000195E                          1428              
0000195E  B87C 0000               1429              CMP     #0,D4
00001962  6600 0066               1430              BNE     .END
00001966  3039 00002898           1431              MOVE.W  BPOSX2,D0
0000196C  3239 0000289A           1432              MOVE.W  BPOSY1,D1
00001972  3A39 00002896           1433              MOVE.W  BPOSX1,D5
00001978  3C39 0000289C           1434              MOVE.W  BPOSY2,D6
0000197E  4EB8 13B6               1435              JSR     UTLCOLBL
00001982  B87C 0000               1436              CMP     #0,D4
00001986  6600 0042               1437              BNE     .END
0000198A  3039 00002896           1438              MOVE.W  BPOSX1,D0
00001990  3239 0000289C           1439              MOVE.W  BPOSY2,D1
00001996  3A39 00002898           1440              MOVE.W  BPOSX2,D5
0000199C  3C39 0000289A           1441              MOVE.W  BPOSY1,D6
000019A2  4EB8 13B6               1442              JSR     UTLCOLBL
000019A6  B87C 0000               1443              CMP     #0,D4
000019AA  6600 001E               1444              BNE     .END
000019AE  3039 00002898           1445              MOVE.W  BPOSX2,D0
000019B4  3239 0000289C           1446              MOVE.W  BPOSY2,D1
000019BA  3A39 00002896           1447              MOVE.W  BPOSX1,D5
000019C0  3C39 0000289A           1448              MOVE.W  BPOSY1,D6
000019C6  4EB8 13B6               1449              JSR     UTLCOLBL   
000019CA                          1450  
000019CA                          1451  .END            
000019CA                          1452  
000019CA  3039 00002890           1453              MOVE.W  BSPEEDX,D0              ;POSICIÓN = POSICIÓN + VELOCIDAD
000019D0  D179 00002896           1454              ADD.W   D0,BPOSX1
000019D6  D179 00002898           1455              ADD.W   D0,BPOSX2
000019DC                          1456              
000019DC  3239 00002892           1457              MOVE.W  BSPEEDY,D1
000019E2  D379 0000289A           1458              ADD.W   D1,BPOSY1
000019E8  D379 0000289C           1459              ADD.W   D1,BPOSY2
000019EE  4CDF 01FF               1460              MOVEM.L (A7)+,D0-D7/A0
000019F2                          1461              
000019F2  4E75                    1462              RTS
000019F4                          1463  
000019F4                          1464  BPLOT       
000019F4  48E7 F800               1465              MOVEM.L  D0-D4,-(A7)
000019F8                          1466              ;CONTOUR COLOR
000019F8  223C 00FFFFFF           1467              MOVE.L  #BINCOLOR,D1  
000019FE  103C 0050               1468              MOVE.B  #80,D0
00001A02  4E4F                    1469              TRAP    #15
00001A04                          1470      
00001A04                          1471               ;FILL COLOR
00001A04  223C 00FFFFFF           1472              MOVE.L   #BINCOLOR,D1  
00001A0A  103C 0051               1473              MOVE.B  #81,D0
00001A0E  4E4F                    1474              TRAP    #15
00001A10                          1475   
00001A10                          1476              ;CIRCLE
00001A10                          1477  
00001A10  3239 00002896           1478              MOVE.W  BPOSX1,D1
00001A16  3439 0000289A           1479              MOVE.W  BPOSY1,D2
00001A1C  3639 00002898           1480              MOVE.W  BPOSX2,D3
00001A22  3839 0000289C           1481              MOVE.W  BPOSY2,D4
00001A28  103C 0058               1482              MOVE.B  #88,D0
00001A2C  4E4F                    1483              TRAP    #15
00001A2E                          1484      
00001A2E  4CDF 001F               1485              MOVEM.L  (A7)+,D0-D4
00001A32                          1486  
00001A32  4E75                    1487              RTS
00001A34                          1488  
00001A34                          1489  
00001A34                          1490  
00001A34                          1491  
00001A34                          1492  
00001A34                          1493  
00001A34                          1494  
00001A34                          1495  
00001A34                          1496  
00001A34                          1497  
00001A34                          1498  
00001A34                          1499  
00001A34                          1500  
00001A34                          1501  
00001A34                          1502  
00001A34                          1503  
00001A34                          1504  
00001A34                          1505  
00001A34                          1506  
00001A34                          1507  
00001A34                          1508  
00001A34                          1509  
00001A34                          1510  
00001A34                          1511  
00001A34                          1512  
00001A34                          1513  
00001A34                          1514  
00001A34                          1515  
00001A34                          1516  -------------------- end include --------------------
00001A34                          1517              INCLUDE "BLOCKS.X68"           ;BLOQUES
00001A34                          1518  ;-----------------------------------------------------------
00001A34                          1519  ;           BLOCKS
00001A34                          1520  ;-----------------------------------------------------------
00001A34                          1521    
00001A34                          1522  BLINIT
00001A34                          1523  
00001A34  48E7 8080               1524              MOVEM.L D0/A0,-(A7)
00001A38  41F9 000028A0           1525              LEA.L   BLMATRIX,A0
00001A3E                          1526             ; MOVE.W  #BLROW-7,D0             ;7
00001A3E                          1527  .LOOP       
00001A3E  10FC 0080               1528              MOVE.B  #%10000000,(A0)+
00001A42                          1529              ;DBRA    D0,.LOOP
00001A42  10FC 0000               1530              MOVE.B  #0,(A0)+
00001A46  10FC 0000               1531              MOVE.B  #0,(A0)+
00001A4A  10FC 0000               1532              MOVE.B  #0,(A0)+
00001A4E  10FC 0000               1533              MOVE.B  #0,(A0)+
00001A52  10FC 0000               1534              MOVE.B  #0,(A0)+
00001A56  10FC 0000               1535              MOVE.B  #0,(A0)+
00001A5A  10FC 0000               1536              MOVE.B  #0,(A0)+
00001A5E  10FC 0000               1537              MOVE.B  #0,(A0)+
00001A62  10FC 0000               1538              MOVE.B  #0,(A0)+
00001A66  10FC 0000               1539              MOVE.B  #0,(A0)+
00001A6A  10FC 0000               1540              MOVE.B  #0,(A0)+
00001A6E                          1541              ;MOVE.B  #%11111111,(A0)+
00001A6E  4279 0000289E           1542              CLR.W   BLCOUNTER
00001A74  4279 0000288E           1543              CLR.W   LEVEL
00001A7A  4CDF 0101               1544              MOVEM.L (A7)+,D0/A0
00001A7E  4E75                    1545              RTS
00001A80                          1546              
00001A80                          1547  BLLEV2           
00001A80  48E7 8080               1548              MOVEM.L D0/A0,-(A7)
00001A84  41F9 000028A0           1549              LEA.L   BLMATRIX,A0
00001A8A  303C 000B               1550              MOVE.W  #BLROW-1,D0             
00001A8E                          1551  .LOOP       
00001A8E  10FC 005A               1552              MOVE.B  #%01011010,(A0)+
00001A92  51C8 FFFA               1553              DBRA    D0,.LOOP
00001A96  4279 0000289E           1554              CLR.W   BLCOUNTER
00001A9C  4CDF 0101               1555              MOVEM.L (A7)+,D0/A0
00001AA0  4E75                    1556              RTS
00001AA2                          1557              
00001AA2                          1558  BLLEV3           
00001AA2  48E7 8080               1559              MOVEM.L D0/A0,-(A7)
00001AA6  41F9 000028A0           1560              LEA.L   BLMATRIX,A0         
00001AAC  10FC 00F5               1561              MOVE.B  #%11110101,(A0)+
00001AB0  10FC 00A5               1562              MOVE.B  #%10100101,(A0)+
00001AB4  10FC 00A5               1563              MOVE.B  #%10100101,(A0)+
00001AB8  10FC 00A5               1564              MOVE.B  #%10100101,(A0)+
00001ABC  10FC 00A5               1565              MOVE.B  #%10100101,(A0)+
00001AC0  10FC 00E5               1566              MOVE.B  #%11100101,(A0)+
00001AC4  10FC 00A5               1567              MOVE.B  #%10100101,(A0)+
00001AC8  10FC 00A5               1568              MOVE.B  #%10100101,(A0)+
00001ACC  10FC 00A5               1569              MOVE.B  #%10100101,(A0)+
00001AD0  10FC 00A5               1570              MOVE.B  #%10100101,(A0)+
00001AD4  10FC 00A5               1571              MOVE.B  #%10100101,(A0)+
00001AD8  10FC 00F5               1572              MOVE.B  #%11110101,(A0)+
00001ADC  4279 0000289E           1573              CLR.W   BLCOUNTER
00001AE2  4CDF 0101               1574              MOVEM.L (A7)+,D0/A0
00001AE6  4E75                    1575              RTS
00001AE8                          1576              
00001AE8                          1577  BLUPD       
00001AE8  48E7 C000               1578              MOVEM.L D0-D1,-(A7)
00001AEC  3039 0000289E           1579              MOVE.W  BLCOUNTER,D0
00001AF2  6700 0008               1580              BEQ     .NEXTLEVEL
00001AF6  4EF9 00001B28           1581              JMP     .END
00001AFC                          1582  .NEXTLEVEL  
00001AFC  5279 0000288E           1583              ADD.W   #1,LEVEL
00001B02  B27C 0002               1584              CMP     #2,D1                   ;2 = LEVEL 3, 1-2= -1 = EMPEZAR LEVEL 2,  
00001B06  6D00 0014               1585              BLT     .NIVEL2
00001B0A  4EF8 1AA2               1586              JMP     BLLEV3
00001B0E  33FC 0001 00002882      1587              MOVE.W  #STASPACE,(STANEXT)
00001B16  4EF9 00001B28           1588              JMP     .END
00001B1C                          1589  .NIVEL2
00001B1C  4EF8 1A80               1590              JMP     BLLEV2   
00001B20  33FC 0001 00002882      1591              MOVE.W  #STASPACE,(STANEXT)
00001B28                          1592              
00001B28                          1593  .END        
00001B28  4CDF 0003               1594              MOVEM.L (A7)+,D0-D1  
00001B2C  4E75                    1595              RTS          
00001B2E                          1596  
00001B2E                          1597  BLPLOT
00001B2E  48E7 FFC0               1598              MOVEM.L D0-D7/A0-A1,-(A7)
00001B32  103C 0050               1599              MOVE.B  #80,D0                  ;SET PEN COLOR
00001B36  7200                    1600              MOVE.L  #0,D1
00001B38  4E4F                    1601              TRAP    #15
00001B3A                          1602              
00001B3A  4242                    1603              CLR.W   D2                      ;UPPER Y
00001B3C  383C 0010               1604              MOVE.W  #BLHEIGHT,D4            ;DOWN Y
00001B40  41F8 11DC               1605              LEA     COLORS,A0
00001B44                          1606              
00001B44  3A3C 000B               1607              MOVE.W  #BLROW-1,D5    ;DBRA
00001B48  227C 00000000           1608              MOVE.L  #0,A1                      ;PARA SABER CUAL PONER D6= FILA
00001B4E                          1609              
00001B4E                          1610  .LOOP2                                      ;BUCLE DE FILAS
00001B4E                          1611   
00001B4E  103C 0051               1612              MOVE.B  #81,D0                  ;SET COLOR
00001B52  2218                    1613              MOVE.L  (A0)+,D1
00001B54  4E4F                    1614              TRAP    #15
00001B56                          1615                                        ;BUCLE FILAS
00001B56                          1616              
00001B56  363C 0040               1617              MOVE.W  #BLWIDTH,D3             ;RIGHT X
00001B5A  4241                    1618              CLR.W   D1                      ;LEFT X
00001B5C                          1619              
00001B5C  3F05                    1620              MOVE.W  D5,-(A7)                ;GUARDO EL VALOR DEL DECREMENTO DE LOOP2
00001B5E  3A3C 0007               1621              MOVE.W  #BLCOL-1,D5
00001B62  1C29 28A0               1622              MOVE.B  BLMATRIX(A1),D6
00001B66                          1623  .LOOP1                                      ; BUCLE COLUMNAS
00001B66                          1624             
00001B66  E31E                    1625              ROL.B   #1,D6
00001B68  6400 000E               1626              BCC     .SALTO                  ; SALTA SI CARRY = 0
00001B6C                          1627              
00001B6C  103C 0057               1628              MOVE.B  #87,D0                  ; DIBUJAMOS EL CUADRADO
00001B70  4E4F                    1629              TRAP    #15
00001B72  5279 0000289E           1630              ADD.W   #1,BLCOUNTER
00001B78                          1631  .SALTO
00001B78  3203                    1632              MOVE.W  D3,D1
00001B7A  0643 0040               1633              ADD.W   #BLWIDTH, D3
00001B7E  5247                    1634              ADDI.W  #1,D7
00001B80  51CD FFE4               1635              DBRA    D5,.LOOP1 
00001B84  3A1F                    1636              MOVE.W  (A7)+,D5              
00001B86                          1637  
00001B86  5249                    1638              ADDA.W  #1,A1
00001B88  3404                    1639              MOVE.W  D4,D2
00001B8A  0644 0010               1640              ADD.W   #BLHEIGHT,D4
00001B8E  51CD FFBE               1641              DBRA    D5,.LOOP2
00001B92  4CDF 03FF               1642              MOVEM.L (A7)+,D0-D7/A0-A1
00001B96  4E75                    1643              RTS
00001B98                          1644  
00001B98                          1645  
00001B98                          1646  
00001B98                          1647  -------------------- end include --------------------
00001B98                          1648  
00001B98                          1649  ; --- INITIALIZE --------------------------------------------------------------
00001B98                          1650              
00001B98  4EB8 1000               1651  START       JSR     SYSINIT
00001B9C                          1652              ; TO DO: CALL GAME INITIALIZATION CODE HERE
00001B9C  4EB8 1676               1653              JSR     STAINIT                 ;INICIA LAS PANTALLAS            
00001BA0                          1654              
00001BA0                          1655  ; --- UPDATE ------------------------------------------------------------------
00001BA0                          1656  
00001BA0  4E40                    1657  .LOOP       TRAP    #KBDTRAP                ; READ KEYBOARD                 
00001BA2                          1658                                              ; UPDATE DEPENDING ON THE STATE
00001BA2                          1659              ; TO DO: CALL GAME UPDATE CODE HERE
00001BA2  4EB8 1688               1660              JSR     STAUPD
00001BA6                          1661  
00001BA6                          1662  ; --- WAIT SYNCH --------------------------------------------------------------
00001BA6                          1663  
00001BA6  4A39 00001BC2           1664  .WINT       TST.B   (SCRINTCT)              ; WAIT FOR INTERRUPT
00001BAC  67F8                    1665              BEQ     .WINT
00001BAE                          1666              
00001BAE  4239 00001BC2           1667              CLR.B   (SCRINTCT)
00001BB4                          1668  
00001BB4                          1669  ; --- PLOT --------------------------------------------------------------------
00001BB4                          1670              
00001BB4                          1671              ; TO DO: CALL GAME PLOT CODE HERE
00001BB4  4EB8 16E2               1672              JSR     STAPLOT
00001BB8                          1673  
00001BB8  4E41                    1674              TRAP    #SCRTRAP                ; SHOW GRAPHICS
00001BBA  60E4                    1675              BRA     .LOOP
00001BBC  FFFF FFFF               1676              SIMHALT
00001BC0                          1677  
00001BC0                          1678  ; --- VARIABLES ---------------------------------------------------------------
00001BC0                          1679  
00001BC0                          1680              INCLUDE "SYSVAR.X68"
00001BC0                          1681  ; =============================================================================
00001BC0                          1682  ; SYSTEM VARS
00001BC0                          1683  ; NOTE THAT ALL THESE VARS ARE USED TO SHARE DATA FROM SYSTEM TO USER. THUS
00001BC0                          1684  ; THEY MUST NOT BE IN PROTECTED MEMORY.
00001BC0                          1685  ; NOTE THAT USING DMMDATA IN SUCH WAY IS A BAD IDEA, AS USER APPLICATIONS CAN
00001BC0                          1686  ; ALSO FREE OR CHANGE OWNERSHIP. NONETHELESS, FOR THE SAKE OF THIS EXAMPLE
00001BC0                          1687  ; THIS IS GOOD ENOUGH.
00001BC0                          1688  ; =============================================================================
00001BC0                          1689  
00001BC0                          1690  ; --- KEYBOARD RELATED VARIABLES ----------------------------------------------
00001BC0                          1691  
00001BC0                          1692  KBDVAL      DS.B    1                       ; KEY PRESSED=1
00001BC1                          1693  KBDEDGE     DS.B    1                       ; KEY CHANGED=1
00001BC2                          1694  
00001BC2                          1695              DS.W    0
00001BC2                          1696  
00001BC2                          1697  ; --- SCREEN RELATED VARIABLES ------------------------------------------------
00001BC2                          1698  
00001BC2                          1699  SCRINTCT    DS.B    1                       ; INTERRUPT COUNTER/FLAG
00001BC3                          1700  SCRCYCCT    DS.B    1                       ; CYCLE COUNTER
00001BC4                          1701              DS.W    0
00001BC4                          1702  
00001BC4                          1703  ; --- DYNAMIC MEMORY VARIABLES ------------------------------------------------
00001BC4                          1704  
00001C00                          1705              ORG     (*+DMMBSIZE-1)&-DMMBSIZE ; ALIGN TO DMMBSIZE
00001C00                          1706  DMMDATA     DS.B    DMMBSIZE*DMMBNUM        ; DYNAMIC MEMORY ALLOCATION SPACE
00002880                          1707              DS.W    0                       ; JUST IN CASE (SIZE IS POW OF TWO)
00002880                          1708  
00002880                          1709  
00002880                          1710  
00002880                          1711  -------------------- end include --------------------
00002880                          1712              INCLUDE "VAR.X68"
00002880                          1713  ; =============================================================================
00002880                          1714  ; GAME VARS
00002880                          1715  ; =============================================================================
00002880                          1716  
00002880                          1717  ; TO DO: DECLARE GAME VARIABLES HERE.
00002880                          1718  
00002880                          1719  ; --- GAME STATE RELATED VARIABLES ------------------------------------------
00002880                          1720  
00002880                          1721  STACUR      DS.W    1                       ; CURRENT GAME STATE
00002882                          1722  STANEXT     DS.W    1                       ; NEXT GAME STATE
00002884                          1723  ;----------------------------------------------------------------------------
00002884                          1724  
00002884                          1725  ; PLAYER --------------------------------------------------------------------
00002884                          1726  PPOSX       DS.W    1                       ;POSICION DE LA PLATAFORMA
00002886                          1727  PWIDTH      DS.W    1                       ; PLAYER WIDTH (PIXELS)
00002888                          1728  PLIVES      DS.W    1                       ;LIVES LEFT
0000288A                          1729  PSCORE      DS.W    1                       ;SCORE DEL PLAYER
0000288C                          1730  PSPEED      DS.W    1
0000288E                          1731  LEVEL       DS.B    2
00002890                          1732  
00002890                          1733  ;----------------------------------------------------------------------------
00002890                          1734  
00002890                          1735  ; BALL ----------------------------------------------------------------------
00002890                          1736  ;BPOSX       DS.W    1                       ;POSICION DE LA PELOTA X
00002890                          1737  ;BPOSY       DS.W    1                       ;POSICION DE LA PELOTA Y
00002890                          1738  BSPEEDX     DS.W    1                       ;VELOCIDAD DE LA PELOTA
00002892                          1739  BSPEEDY     DS.W    1
00002894                          1740  BCOLOR      DS.W    1
00002896                          1741  BPOSX1      DS.W    1
00002898                          1742  BPOSX2      DS.W    1
0000289A                          1743  BPOSY1      DS.W    1
0000289C                          1744  BPOSY2      DS.W    1
0000289E                          1745  ; BLOCKS --------------------------------------------------------------------
0000289E                          1746  BLCOUNTER   DS.W    1
000028A0                          1747  BLMATRIX    DS.B    BLROW  ;12*8
000028AC                          1748              DS.W    0
000028AC                          1749              
000028AC                          1750  
000028AC                          1751  
000028AC                          1752  
000028AC                          1753  
000028AC                          1754  
000028AC                          1755  
000028AC                          1756  
000028AC                          1757  -------------------- end include --------------------
000028AC                          1758              END    START

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
BCOLOR              2894
BDIAMET             A
BINCOLOR            FFFFFF
BINIT               1894
BINPOSX             FB
BINPOSY             1CE
BINSPEED            FFFFFFFD
BLCOL               8
BLCOUNTER           289E
BLHEIGHT            10
BLINIT              1A34
BLINIT:LOOP         1A3E
BLLEV2              1A80
BLLEV2:LOOP         1A8E
BLLEV3              1AA2
BLMATRIX            28A0
BLPLOT              1B2E
BLPLOT:LOOP1        1B66
BLPLOT:LOOP2        1B4E
BLPLOT:SALTO        1B78
BLROW               C
BLUE                F7E78E
BLUPD               1AE8
BLUPD:END           1B28
BLUPD:NEXTLEVEL     1AFC
BLUPD:NIVEL2        1B1C
BLWIDTH             40
BNXTLEV             18C6
BNXTLEV:END         1922
BNXTLEV:NEGX        191C
BNXTLEV:NEGY        1900
BNXTLEV:X           1906
BPLOT               19F4
BPOSX1              2896
BPOSX2              2898
BPOSY1              289A
BPOSY2              289C
BSPEEDX             2890
BSPEEDY             2892
BUPD                1928
BUPD:END            19CA
COLORS              11DC
DMMALLOC            11AC
DMMALLOC:END        11C4
DMMBNUM             32
DMMBSIZE            40
DMMDATA             1C00
DMMFCOM             1186
DMMFFND             1194
DMMFIRST            113C
DMMFLOOP            117A
DMMFRCOM            114E
DMMFREE             11C6
DMMFRFND            115C
DMMFRLOP            1142
DMMFRSTO            1174
DMMINIT             111A
DMMINIT:LOOP        1128
DMMNEXT             115E
DMMNEXTO            1196
DMMSYSID            0
GOVERC              FFFF
GOVERX              12
GOVERY              7
GREEN               95FF8C
INTPRSC             FFFFFF
INTPRSX             20
INTPRSY             52
INTTITC             DCAA7C
INTTITX             E
INTTITY             7
KBDBITDN            3
KBDBITF1            4
KBDBITF2            5
KBDBITF3            6
KBDBITLF            0
KBDBITPS            7
KBDBITRT            2
KBDBITUP            1
KBDCHRDN            28
KBDCHRLF            25
KBDCHRMK            4D
KBDCHRPK            50
KBDCHRRT            27
KBDCHRSH            10
KBDCHRSP            20
KBDCHRUP            26
KBDDOWN             28
KBDEDGE             1BC1
KBDFIRE1            20
KBDFIRE2            4D
KBDFIRE3            10
KBDINIT             10A6
KBDLEFT             25
KBDMSKDN            8
KBDMSKF1            10
KBDMSKF2            20
KBDMSKF3            40
KBDMSKLF            1
KBDMSKPS            80
KBDMSKRT            4
KBDMSKUP            2
KBDPAUSE            50
KBDREAD             10BC
KBDREAD:LOOP1       10D2
KBDREAD:LOOP2       10EE
KBDRIGHT            27
KBDTRAP             0
KBDUP               26
KBDVAL              1BC0
LEVEL               288E
LIVECOLOR           FF
LIVEHEIGHT          10
LIVEPOSX            215
LIVEPOSY            1E
LIVEWIDTH           40
ORANGE              4E8CF3
PCOLOR              ECD59D
PHEIGHT             C
PINLIVE             3
PINPOSX1            E0
PINPOSX2            E4
PINPOSX3            E8
PINWIDTH1           40
PINWIDTH2           38
PINWIDTH3           30
PLIVES              2888
PLRINIT             153C
PLRREV              154E
PLRUPD              1560
PLRUPD:END          15A6
PLRUPD:RIGHTKEY     1584
PMOVE               8
PPLOT               15AC
PPLOT:END           1668
PPLOT:LOOP          1626
PPLOT:TXTSCORE      166E
PPOSX               2884
PPOSY               1D0
PSCORE              288A
PSCORECOL           FFFFFF
PSCORETX            32
PSCORETY            4
PSPEED              288C
PURPLE              FFACAC
PWIDTH              2886
SCRCTRL             201
SCRCYCCT            1BC3
SCRHEIGH            1E0
SCRINIT             101C
SCRINTCT            1BC2
SCRIRQ              1
SCRISR              107E
SCRLWIDTH           5
SCRTIM              14
SCRTRAP             1
SCRUPD              108C
SCRWIDTH            2E4
STACUR              2880
STAEMPTY            170E
STAGOVR             3
STAGOVRP            1858
STAGOVRP:GOVSTR     188A
STAGOVRU            183A
STAGOVRU:END        1856
STAINIT             1676
STAINTR             0
STAINTRI            175A
STAINTRI:SOUND      1776
STAINTRP            17BC
STAINTRP:PRSSTR     1826
STAINTRP:TITSTR     1816
STAINTRU            178A
STAINTRU:END        17BA
STANEXT             2882
STANONE             FFFFFFFF
STAPLAY             2
STAPLAYI            1710
STAPLAYP            1744
STAPLAYU            1732
STAPLOT             16E2
STAPLOT:PLTTBL      16FE
START               1B98
START:LOOP          1BA0
START:WINT          1BA6
STASPACE            1
STASPACEU           171C
STASPACEU:END       1730
STAUPD              1688
STAUPD:DOUPD        16AE
STAUPD:INITBL       16C6
STAUPD:UPDTBL       16D2
SYSINIT             1000
TXBSIZE             12
TXMSIZE             10
TXSSIZE             A
UTLCHCOL            1494
UTLCHCOL:END        14C2
UTLCHCOL:NOCOL      14C0
UTLCHCOLP           131E
UTLCHCOLP:END       13B0
UTLCHCOLP:LADOS     13AA
UTLCHCOLP:PLRXMIDDLE  1364
UTLCHCOLP:PLRXRIGHT  1392
UTLCHCOLW           120C
UTLCHCOLW:COLLISIONS  12EE
UTLCHCOLW:DOWN      1278
UTLCHCOLW:END       12E8
UTLCHCOLW:LEFT      1236
UTLCHCOLW:MINLIVE   1284
UTLCHCOLW:RESET     12E0
UTLCHCOLW:RIGHT     1256
UTLCHCOLW:SOUNDG    12F6
UTLCHCOLW:SOUNDL    130A
UTLCOLBL            13B6
UTLCOLBL:CHOQUEDOBLE  13FA
UTLCOLBL:CHOQUEDOBLEIZQ  1428
UTLCOLBL:DERECHA    1446
UTLCOLBL:ENDCOLISION  1452
UTLCOLBL:ENDNOCOLISION  1482
UTLCOLBL:ENMEDIO    1434
UTLCOLBL:IZQ        13E0
UTLCOLBL:SOUND      1484
UTLCOLBL:TEST       13DA
UTLCOLBL:TEST2      1410
UTLLOCT             3CF
UTLSCTRLP           14C8
UTLSCTRLP:TXTSCORE  1534
UTLSFIL             2A5
UTLSIZC             12A
UTLSNDS             4F7
UTLSNDST            6F3
UTLSPEN             0
YELLOW              38EEF8
